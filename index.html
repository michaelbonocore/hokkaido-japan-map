<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetaPixel's Hokkaido Adventure</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        #map {
            width: 100%;
            height: 100vh;
            cursor: crosshair;
        }
        .leaflet-container {
            cursor: crosshair;
        }
        .leaflet-marker-icon, .leaflet-popup {
            cursor: pointer;
        }
        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(180deg, rgba(26,95,122,0.95) 0%, rgba(26,95,122,0.8) 100%);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .header h1 {
            color: #fff;
            font-size: 1.25rem;
            font-weight: 600;
        }
        .header .subtitle {
            color: rgba(255,255,255,0.8);
            font-size: 0.85rem;
        }
        .legend-toggle {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: #fff;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s;
        }
        .legend-toggle:hover {
            background: rgba(255,255,255,0.3);
        }
        .sidebar {
            position: absolute;
            top: 60px;
            right: 10px;
            z-index: 1000;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.2);
            width: 280px;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
            display: none;
        }
        .sidebar.active {
            display: block;
        }
        .sidebar-section {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .sidebar-section:last-child {
            border-bottom: none;
        }
        .sidebar-section h3 {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 0;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .legend-item.disabled {
            opacity: 0.4;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        .legend-label {
            font-size: 0.85rem;
            color: #333;
        }
        .legend-count {
            margin-left: auto;
            font-size: 0.75rem;
            color: #999;
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 10px;
        }
        .special-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            font-size: 0.85rem;
        }
        .special-icon {
            font-size: 1rem;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.2);
        }
        .leaflet-popup-content {
            margin: 0;
            min-width: 280px;
            max-width: 320px;
        }
        .popup-header {
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            color: #fff;
        }
        .popup-header h3 {
            font-size: 1rem;
            margin-bottom: 2px;
        }
        .popup-header .local-name {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        .popup-badges {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        .popup-badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.2);
        }
        .popup-body {
            padding: 12px 15px;
        }
        .popup-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }
        .popup-meta-item {
            font-size: 0.8rem;
        }
        .popup-meta-item label {
            color: #666;
            display: block;
            margin-bottom: 2px;
        }
        .popup-meta-item span {
            color: #333;
            font-weight: 500;
        }
        .popup-features {
            font-size: 0.85rem;
            color: #444;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        .popup-notes {
            font-size: 0.8rem;
            color: #666;
            background: #f8f8f8;
            padding: 10px;
            border-radius: 6px;
            line-height: 1.4;
        }
        .popup-notes strong {
            color: #333;
        }
        .popup-link {
            display: inline-block;
            margin-top: 10px;
            color: #1a5f7a;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .popup-link:hover {
            text-decoration: underline;
        }
        .popup-links {
            margin-top: 10px;
        }
        .popup-links .popup-link {
            margin-top: 0;
            display: block;
            margin-bottom: 6px;
        }
        .popup-links .popup-link:last-child {
            margin-bottom: 0;
        }
        .popup-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        .popup-button {
            flex: 1;
            text-align: center;
            padding: 8px 12px;
            background: #1a5f7a;
            color: #fff;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: background 0.2s;
        }
        .popup-button:hover {
            background: #0d3d4d;
        }
        .popup-button.secondary {
            background: #e67e22;
        }
        .popup-button.secondary:hover {
            background: #d35400;
        }
        .popup-recommendation {
            font-size: 0.8rem;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            line-height: 1.4;
        }
        .popup-recommendation.recommended {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        .popup-recommendation.not-recommended {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .popup-recommendation.conditional {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .popup-recommendation strong {
            color: #333;
        }
        .region-popup .popup-body {
            padding: 15px;
        }
        .region-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 12px;
        }
        .region-stat {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        .region-stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a5f7a;
        }
        .region-stat-label {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
        }
        .transport-popup {
            min-width: 250px;
        }
        .transport-popup .popup-header {
            background: #6c757d;
        }
        .transport-route {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .transport-point {
            text-align: center;
        }
        .transport-point .city {
            font-weight: 600;
            font-size: 0.9rem;
        }
        .transport-arrow {
            color: #999;
            font-size: 1.2rem;
        }
        .priority-high {
            border-left: 4px solid #dc3545;
        }
        .priority-medium {
            border-left: 4px solid #ffc107;
        }
        .priority-low {
            border-left: 4px solid #6c757d;
        }
        /* Location List Styles */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }
        .section-header h3 {
            margin-bottom: 0;
        }
        .section-toggle {
            font-size: 0.7rem;
            color: #999;
            transition: transform 0.2s;
        }
        .section-header.collapsed .section-toggle {
            transform: rotate(-90deg);
        }
        .section-content {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .section-content.collapsed {
            max-height: 0 !important;
        }
        .list-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .list-control-btn {
            font-size: 0.7rem;
            color: #1a5f7a;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            text-decoration: underline;
        }
        .list-control-btn:hover {
            color: #0d3d4d;
        }
        .category-group {
            margin-bottom: 8px;
        }
        .category-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            cursor: pointer;
            user-select: none;
        }
        .category-header:hover {
            background: #f8f8f8;
            margin: 0 -15px;
            padding: 6px 15px;
        }
        .category-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .category-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: #333;
            flex-grow: 1;
        }
        .category-toggle {
            font-size: 0.65rem;
            color: #999;
            transition: transform 0.2s;
        }
        .category-header.collapsed .category-toggle {
            transform: rotate(-90deg);
        }
        .category-locations {
            padding-left: 18px;
            overflow: hidden;
            transition: max-height 0.25s ease;
        }
        .category-locations.collapsed {
            max-height: 0 !important;
        }
        .location-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 0;
            cursor: pointer;
            transition: background 0.15s;
        }
        .location-item:hover {
            background: #f0f7fa;
            margin: 0 -15px;
            padding: 4px 15px;
        }
        .location-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .location-name {
            font-size: 0.8rem;
            color: #444;
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .location-item.high-priority .location-name {
            font-weight: 600;
        }
        .priority-star {
            color: #ffc107;
            font-size: 0.7rem;
            flex-shrink: 0;
        }
        .locations-section {
            max-height: 400px;
            overflow-y: auto;
        }
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1rem;
            }
            .header .subtitle {
                display: none;
            }
            .sidebar {
                width: calc(100% - 20px);
                right: 10px;
                left: 10px;
            }
            .locations-section {
                max-height: 250px;
            }
        }

        /* ===== DEV TOOLS: GPS Capture & Edit Mode ===== */
        .coords-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            z-index: 2000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: none;
        }
        .coords-toast.show {
            display: block;
            animation: fadeInOut 2.5s ease-in-out;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        }
        .edit-mode-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
        }
        .edit-mode-toggle label {
            font-size: 0.85rem;
            color: #333;
            cursor: pointer;
        }
        .edit-mode-switch {
            position: relative;
            width: 44px;
            height: 24px;
        }
        .edit-mode-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .edit-mode-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 24px;
        }
        .edit-mode-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        .edit-mode-switch input:checked + .edit-mode-slider {
            background-color: #4A90D9;
        }
        .edit-mode-switch input:checked + .edit-mode-slider:before {
            transform: translateX(20px);
        }
        .popup-edit-btn {
            display: none;
            background: #4A90D9;
            color: #fff;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 10px;
        }
        .popup-edit-btn:hover {
            background: #357ABD;
        }
        .popup-edit-btn.cancel {
            background: #6c757d;
            margin-left: 8px;
        }
        .popup-edit-btn.cancel:hover {
            background: #545b62;
        }
        body.edit-mode-on .popup-edit-btn {
            display: inline-block;
        }
        .popup-body.editing {
            background: #fffef0;
            border: 2px dashed #4A90D9;
            border-radius: 0 0 8px 8px;
        }
        .popup-body.editing .editable-field {
            background: #fff;
            border: 1px solid #ddd;
            padding: 4px 6px;
            border-radius: 3px;
            width: 100%;
            font-family: inherit;
            font-size: inherit;
            margin: 2px 0;
        }
        .popup-body.editing textarea.editable-field {
            min-height: 60px;
            resize: vertical;
        }
        .popup-body.editing .popup-meta-item span {
            display: none;
        }
        .popup-body.editing .popup-features,
        .popup-body.editing .popup-notes-text,
        .popup-body.editing .popup-recommendation-text {
            display: none;
        }
        .edit-actions {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }
        /* Export Modal */
        .export-btn {
            display: none;
            width: 100%;
            background: #28a745;
            color: #fff;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        .export-btn:hover {
            background: #218838;
        }
        body.edit-mode-on .export-btn {
            display: block;
        }
        .export-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }
        .export-modal-overlay.show {
            display: flex;
        }
        .export-modal {
            background: #fff;
            border-radius: 8px;
            max-width: 700px;
            max-height: 80vh;
            width: 90%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .export-modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .export-modal-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }
        .export-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }
        .export-modal-close:hover {
            color: #333;
        }
        .export-modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }
        .export-modal-body pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .export-modal-footer {
            padding: 12px 20px;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .export-modal-footer button {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .export-copy-btn {
            background: #4A90D9;
            color: #fff;
            border: none;
        }
        .export-copy-btn:hover {
            background: #357ABD;
        }
        .export-close-btn {
            background: #fff;
            border: 1px solid #ddd;
            color: #333;
        }
        .export-close-btn:hover {
            background: #f8f9fa;
        }
        .no-changes-msg {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1>PetaPixel's Hokkaido Adventure</h1>
            <span class="subtitle">March 2 - 8, 2026</span>
        </div>
        <button class="legend-toggle" onclick="toggleSidebar()">Legend</button>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <h3>Categories</h3>
            <div id="category-legend"></div>
        </div>
        <div class="sidebar-section">
            <h3>Special Designations</h3>
            <div class="special-item"><span class="special-icon">üèõÔ∏è</span> UNESCO World Heritage Site</div>
            <div class="special-item"><span class="special-icon">üèûÔ∏è</span> National Park</div>
            <div class="special-item"><span class="special-icon">‚≠ê</span> Jaron Proposed</div>
            <div class="special-item"><span class="special-icon">üîç</span> Producer Discovery</div>
        </div>
        <div class="sidebar-section">
            <h3>Layers</h3>
            <div class="legend-item" onclick="toggleLayer('transport')">
                <div class="legend-color" style="background: #6c757d;"></div>
                <span class="legend-label">Transportation Routes</span>
            </div>
            <div class="legend-item" onclick="toggleLayer('regions')">
                <div class="legend-color" style="background: #ffc107;"></div>
                <span class="legend-label">Regional Overviews</span>
            </div>
        </div>
        <div class="sidebar-section">
            <h3>üöï Transport Note</h3>
            <div class="special-item" style="font-size: 11px; line-height: 1.4;">Uber works in Japan as a taxi-hailing app (not rideshare). Download the Uber app before your trip. Backup: GO app has wider coverage if Uber shows no cars.</div>
        </div>
        <div class="sidebar-section">
            <h3>üõ†Ô∏è Dev Tools</h3>
            <div class="edit-mode-toggle">
                <label class="edit-mode-switch">
                    <input type="checkbox" id="editModeToggle" onchange="toggleEditMode()">
                    <span class="edit-mode-slider"></span>
                </label>
                <label for="editModeToggle">Edit Mode</label>
            </div>
            <div class="special-item" style="font-size: 10px; color: #999;">Right-click map to copy GPS coords</div>
            <button class="export-btn" onclick="exportChanges()">üìã Export Changes</button>
        </div>
        <div class="sidebar-section">
            <div class="section-header collapsed" onclick="toggleLocationsSection()">
                <h3>Locations</h3>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content collapsed" id="locations-section">
                <div class="list-controls">
                    <button class="list-control-btn" onclick="expandAllCategories(event)">Expand All</button>
                    <button class="list-control-btn" onclick="collapseAllCategories(event)">Collapse All</button>
                </div>
                <div class="locations-section" id="location-list"></div>
            </div>
        </div>
    </div>

    <div id="map"></div>
    <div class="coords-toast" id="coordsToast"></div>

    <!-- Export Changes Modal -->
    <div class="export-modal-overlay" id="exportModal">
        <div class="export-modal">
            <div class="export-modal-header">
                <h3>üìã Export Changes</h3>
                <button class="export-modal-close" onclick="closeExportModal()">&times;</button>
            </div>
            <div class="export-modal-body">
                <pre id="exportContent"></pre>
            </div>
            <div class="export-modal-footer">
                <button class="export-close-btn" onclick="closeExportModal()">Close</button>
                <button class="export-copy-btn" onclick="copyExportToClipboard()">üìã Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script>
        // Category definitions
        const categories = {
            'Landscape/Nature': { color: '#28a745', description: 'Natural landmarks, volcanic areas, lakes, parks, scenic viewpoints' },
            'Food/Culture': { color: '#dc3545', description: 'Restaurants, markets, food experiences, cultural dining' },
            'Architecture': { color: '#fd7e14', description: 'Historic buildings, Western-style structures, traditional streetscapes' },
            'Onsen/Hot Spring': { color: '#e83e8c', description: 'Hot spring areas, bathing experiences, geothermal sites' },
            'Winter Activity': { color: '#17a2b8', description: 'Ski resorts, ice fishing, frozen lake activities' },
            'Transport Hub': { color: '#6c757d', description: 'Train stations, airports, major transit points' },
            'Regional Overview': { color: '#ffc107', description: 'City/area summary markers for navigation' },
            'Wildlife': { color: '#20c997', description: 'Animal encounters, nature experiences with wildlife' },
            'Craft/Culture': { color: '#9c27b0', description: 'Traditional crafts, artisan workshops, cultural shopping' },
            'Lodging': { color: '#4A90D9', description: 'Hotels, ryokans, accommodations' }
        };

        // Regional overviews
        const regions = [
            {
                name: 'Tokyo',
                coords: [35.6812, 139.7671],
                dateRange: 'Day 1 (Departure)',
                locationCount: 1,
                themes: 'Departure point, Shinkansen experience begins',
                hub: 'Tokyo Station - Tohoku/Hokkaido Shinkansen departure',
                budget: 'Transit only'
            },
            {
                name: 'Tohoku',
                coords: [38.5000, 140.5000],
                dateRange: 'Days 1-3',
                locationCount: 8,
                themes: 'Spirited Away fantasy (Ginzan Onsen), Snow Monsters, Three Great Noodles, samurai history, train journey storytelling',
                hub: 'Sendai or Morioka Station - both on Tohoku Shinkansen mainline',
                budget: '$800-1200'
            },
            {
                name: 'Hakodate Area',
                coords: [41.7739, 140.7267],
                dateRange: 'Days 3-5',
                locationCount: 11,
                themes: 'East meets West architecture, morning market live squid fishing, million-dollar night view, hot spring monkeys, frozen lake activities',
                hub: 'Hakodate Station - Hokkaido Shinkansen terminus, tram system',
                budget: '$600-900'
            },
            {
                name: 'Lake Toya-Noboribetsu',
                coords: [42.5500, 141.0000],
                dateRange: 'Days 5-6',
                locationCount: 6,
                themes: 'Volcanic drama, Hell Valley, active geology, "Hokkaido\'s Fuji," healing waters',
                hub: 'Rental car recommended or JR to Noboribetsu Station + bus',
                budget: '$400-600'
            },
            {
                name: 'Otaru',
                coords: [43.1972, 141.0028],
                dateRange: 'Day 6-7',
                locationCount: 3,
                themes: 'Historic canal, sushi capital, romantic winter atmosphere, glasswork',
                hub: 'Otaru Station - 30min from Sapporo on JR',
                budget: '$300-400'
            },
            {
                name: 'Sapporo',
                coords: [43.0621, 141.3544],
                dateRange: 'Days 7-9',
                locationCount: 6,
                themes: 'Urban finale, miso ramen birthplace, beer history, snow festival (if timing aligns), nightlife',
                hub: 'Sapporo Station - hub for all Hokkaido rail, subway system',
                budget: '$500-700'
            },
            {
                name: 'Niseko-Rusutsu',
                coords: [42.8047, 140.7000],
                dateRange: 'Optional Day 8-9',
                locationCount: 2,
                themes: 'World-class powder skiing, Mount Yotei views, international ski culture',
                hub: 'Rental car from Sapporo or resort shuttle buses',
                budget: '$400-800'
            }
        ];

        // All locations
        const locations = [
            {
                name: 'Tokyo Station',
                nameLocal: 'Êù±‰∫¨ÈßÖ',
                category: 'Transport Hub',
                region: 'Tokyo',
                coords: [35.679183, 139.76716],
                dates: 'Day 1 morning',
                bestTime: 'Early morning (6:00-7:00 AM)',
                admission: 'Free',
                permits: 'No - public station',
                features: "This is where the trip starts. The bullet train platforms (20-23) are pretty dramatic with the sleek trains lined up. The station's red brick facade on the Marunouchi side makes for good opening shots.",
                notes: "Get there early if you want tripod shots before the morning rush. Board the Tohoku Shinkansen line (Hayabusa train) to Morioka by 9:00 AM. Approximate departures for the bullet train are  7:16, 7:56, 8:16, and 8:56. There's a famous food hall with like 200 varieties of ekiben (boxed lunches designed for train travel). Worth grabbing some cutaway shots of browsing and eating on the train.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=35.679183,139.76716',
                readMoreUrl: 'https://www.gotokyo.org/en/destinations/central-tokyo/tokyo-station-and-marunouchi/index.html',
                readMoreSource: 'Go Tokyo',
                priority: 'Medium',
                recommendation: "Quick stop before boarding. Grab some ekiben footage and go.",
                recommendationType: 'recommended'
            },
            {
                name: 'Ginzan Onsen',
                nameLocal: 'ÈäÄÂ±±Ê∏©Ê≥â',
                category: 'Onsen/Hot Spring',
                region: 'Tohoku',
                coords: [38.5697, 140.5311],
                dates: 'Optional',
                bestTime: 'Blue hour and night (5:00-8:00 PM)',
                admission: 'Free to walk; Ryokan ¬•25,000-50,000/night',
                permits: 'Yes - nighttime entry tickets required after 5pm Dec-Mar',
                features: "This is supposedly the town that inspired the bathhouse in Spirited Away. Old wooden buildings from the 1920s line a river, lit by gas lamps at night.",
                notes: "You need to book the ryokan (traditional inn) 6-12 months in advance for winter stays. We missed that window. You can still go on a day trip, however, if there's snow (your ideal visual scenario) then most likely they have day restrictions in effect and make you leave before twilight. The gas lamps create this warm golden glow against the blue snow that photographs incredibly well.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=38.5697,140.5311',
                readMoreUrl: 'https://www.japan-guide.com/e/e7975.html',
                readMoreSource: 'Japan Guide',
                priority: 'High',
                recommendation: "NOT RECOMMENDED THIS TRIP. Would also add a full day to the Tohoku leg, eating into Hokkaido time. This should be the centerpiece of a future Tohoku episode, not a rushed, last minute add-on.",
                recommendationType: 'not-recommended'
            },
            {
                name: 'Zao Onsen - Snow Monsters',
                nameLocal: 'ËîµÁéãÊ∏©Ê≥â Ê®πÊ∞∑',
                category: 'Landscape/Nature',
                region: 'Tohoku',
                coords: [38.16506390482376, 140.3956670088516],
                dates: 'Optional',
                bestTime: 'Night ropeway (5:00-9:00 PM) or dawn',
                admission: 'Ropeway ¬•3,500 (~$24)',
                permits: 'No',
                features: "Trees completely encased in ice and snow that look like alien creatures or frozen giants. They call them 'juhyo' (snow monsters). It's one of the weirdest natural phenomena in Japan.",
                notes: "Peak viewing is January-February. By March they might be melting. There's a night ropeway that runs on specific dates, so being there on the right day is a risk. About 40 minutes by Uber from Yamagata Station.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=38.16506390482376,140.3956670088516',
                readMoreUrl: 'https://www.japan.travel/en/spot/661/',
                readMoreSource: 'JNTO',
                priority: 'Medium',
                recommendation: "NOT RECOMMENDED THIS TRIP. You're going in March when they might already be melting. Also requires routing through Yamagata, which adds a full day. We can pair with Ginzan for a future Tohoku winter episode (ideally late January).",
                recommendationType: 'not-recommended'
            },
            {
                name: 'Sendai - Zuihoden Mausoleum',
                nameLocal: 'ÁëûÈ≥≥ÊÆø',
                category: 'Architecture',
                region: 'Tohoku',
                coords: [38.2505346105803, 140.86670734474708],
                dates: 'Optional',
                bestTime: 'Morning (9:00-11:00 AM)',
                admission: '¬•570 (~$4)',
                permits: 'No',
                features: "Mausoleum of Date Masamune, a famous one-eyed samurai lord. Lots of gold, black lacquer, and colorful decorations. Looks striking in snow.",
                notes: "About 15 minutes by Uber from Sendai Station. It's on a forested hillside. Could work for a samurai history angle if you're stopping in Sendai.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=38.2505346105803,140.86670734474708',
                readMoreUrl: 'https://www.zuihoden.com/en/info/',
                readMoreSource: 'Zuihoden',
                priority: 'Low',
                recommendation: 'NOT RECOMMENDED THIS TRIP. Would require Sendai stopover. Save for future Tohoku episode.',
                recommendationType: 'not-recommended'
            },
            {
                name: 'Sendai - Gyutan Restaurant Row',
                nameLocal: 'Áâõ„Çø„É≥ÈÄö„Çä',
                category: 'Food/Culture',
                region: 'Tohoku',
                coords: [38.2603, 140.8821],
                dates: 'Optional',
                bestTime: 'Lunch service (11:30 AM - 1:30 PM)',
                admission: '¬•1,500-2,500 per meal (~$10-17)',
                permits: 'Restaurant permission for filming',
                features: "Sendai's signature dish is gyutan. Thick-cut grilled beef tongue. Smoky and rich flavor served with barley rice and oxtail soup.",
                notes: "There's a whole row of gyutan restaurants in Sendai Station called Gyutan-dori. Would need to ask permission before filming in kitchens.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=38.2603,140.8821',
                readMoreUrl: 'https://livejapan.com/en/in-tohoku/in-pref-miyagi/in-sendai_matubara/article-a3000160/',
                readMoreSource: 'LIVE JAPAN',
                priority: 'Low',
                recommendation: 'NOT RECOMMENDED THIS TRIP. Would require Sendai stopover. Save for future Tohoku episode.',
                recommendationType: 'not-recommended'
            },
            {
                name: 'Sendai Station',
                nameLocal: '‰ªôÂè∞ÈßÖ',
                category: 'Transport Hub',
                region: 'Tohoku',
                coords: [38.26067, 140.882516],
                dates: 'Optional',
                bestTime: 'Transit stop',
                admission: 'Free',
                permits: 'No',
                features: "Major Shinkansen hub in Tohoku. If you're stopping here, the station has Gyutan-dori (beef tongue restaurant row) on the 3rd floor. Otherwise it's a pass-through on the way north.",
                notes: "You don't need to stop here on the current itinerary, but if the route changes, this is where you'd transfer or grab lunch. About 1.5 hours from Tokyo, 40 minutes from Morioka by bullet train.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=38.26067,140.882516',
                priority: 'Low',
                recommendation: 'NOT RECOMMENDED THIS TRIP. Pass-through station only. Included for route planning reference.',
                recommendationType: 'not-recommended'
            },
            {
                name: 'Morioka Station',
                nameLocal: 'ÁõõÂ≤°ÈßÖ',
                category: 'Transport Hub',
                region: 'Tohoku',
                coords: [39.7016, 141.1345],
                dates: 'Day 1 (March 2)',
                bestTime: 'Arrival around 11:15 AM',
                admission: 'Free',
                permits: 'No',
                features: "Your Day 1 home base. The station building has a Pairon branch (jajamen) in the Fesan building, so you can knock out one of the Three Noodles without leaving the station. Coin lockers available for gear.",
                notes: "Drop bags at hotel first if check-in allows, otherwise use station lockers. The IWACHU ironware museum is about 15-20 min by Uber/taxi from here. Shokudoen is a 10-15 min walk.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=39.7016,141.1345',
                readMoreUrl: 'https://www.japan.travel/en/destinations/tohoku/iwate/morioka-and-around/',
                readMoreSource: 'JNTO',
                priority: 'High',
                recommendation: "REQUIRED STOP. Day 1 hub for the Three Noodles of Morioka challenge.",
                recommendationType: 'recommended'
            },
            {
                name: 'Azumaya Honten - Wanko Soba',
                nameLocal: 'Êù±ÂÆ∂Êú¨Â∫ó',
                category: 'Food/Culture',
                region: 'Tohoku',
                coords: [39.701550737711315, 141.15654032738402],
                dates: 'Day 1 (March 2)',
                bestTime: 'Lunch (11:00 AM - 2:00 PM)',
                admission: '¬•4,500 (~$30)',
                permits: 'Yes - contact restaurant; reservations essential',
                features: "This is the wanko soba challenge. Servers keep refilling your tiny bowl of noodles while chanting encouragement. You eat until you slam a lid on your bowl to signal you're done. The record is 570 bowls. A normal person does 60-100 bowls (JNTO cites ~80 as typical). About 15 small bowls equals one regular serving.",
                notes: "The restaurant opened in 1907. Reservations are essential. It's popular. Comes with various toppings like tuna sashimi, mushrooms, and wasabi. This is perfect for a Jaron vs Sarah competition segment.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=39.701550737711315,141.15654032738402',
                readMoreUrl: 'https://www.cnn.com/travel/article/wanko-soba-challenge-japan',
                readMoreSource: 'CNN Travel',
                priority: 'High',
                recommendation: "HIGH PRIORITY. This is your Day 1 competition content. Book a reservation ASAP. The Jaron vs Sarah challenge writes itself.",
                recommendationType: 'recommended'
            },
            {
                name: 'Seikan Tunnel Museum Tappi',
                nameLocal: 'ÈùíÂáΩ„Éà„É≥„Éç„É´Ë®òÂøµÈ§®',
                category: 'Architecture',
                region: 'Tohoku',
                coords: [41.2553, 140.3392],
                dates: 'Optional - requires detour',
                bestTime: 'Morning (9:00 AM - 12:00 PM)',
                admission: '¬•2,200 total (~$15)',
                permits: 'Contact museum for filming',
                features: "Museum about the world's longest undersea tunnel (33 miles total, 14 miles under the sea). There's a cable car that takes you 140 meters below sea level to walk through service tunnels.",
                notes: "Bad news: it's only open April 25 - November 10. Closed during our winter window.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.2553,140.3392',
                priority: 'Low',
                recommendation: "NOT RECOMMENDED THIS TRIP. Museum is closed in winter. But you still pass THROUGH the tunnel on the bullet train. That crossing is a story beat even without the museum.",
                recommendationType: 'not-recommended'
            },
            {
                name: 'Shin-Hakodate-Hokuto Station',
                nameLocal: 'Êñ∞ÂáΩÈ§®ÂåóÊñóÈßÖ',
                category: 'Transport Hub',
                region: 'Hakodate Area',
                coords: [41.9044, 140.6478],
                dates: 'Day 2 (March 3)',
                bestTime: 'Arrival around 12:00 PM',
                admission: 'Free',
                permits: 'No',
                features: "This is where you arrive in Hokkaido. The Shinkansen terminates here, not in Hakodate itself. You'll transfer to the JR Hakodate Liner for the final 20 minutes into town. Good spot for 'we made it to Hokkaido' arrival shots.",
                notes: "Don't linger here. It's a modern transit station with not much else. Grab your arrival moment, then hop on the local train. The Seikan Tunnel crossing (world's longest undersea tunnel) happens just before you arrive here.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.9044,140.6478',
                readMoreUrl: 'https://hakodatestation.com/shin-hakodate-hokuto-station/',
                readMoreSource: 'Hakodate Station Guide',
                priority: 'Medium',
                recommendation: "PASS-THROUGH. Quick arrival shots, then transfer to Hakodate.",
                recommendationType: 'recommended'
            },
            {
                name: 'Hakodate Station',
                nameLocal: 'ÂáΩÈ§®ÈßÖ',
                category: 'Transport Hub',
                region: 'Hakodate Area',
                coords: [41.7731, 140.7281],
                dates: 'Days 2-3 (March 3-4)',
                bestTime: 'Arrival early afternoon',
                admission: 'Free',
                permits: 'No',
                features: "Your Hakodate hub. The famous morning market is right next to the station (walkable). Tram lines start here for getting around the city. Mt. Hakodate ropeway is about 10 min by Uber/taxi.",
                notes: "Day 2 you arrive, drop bags, explore Motomachi district, then catch the Mt. Hakodate night view. Day 3 morning market, then train to Otaru.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.7731,140.7281',
                priority: 'High',
                recommendation: "REQUIRED STOP. Day 2-3 hub.",
                recommendationType: 'recommended'
            },
            {
                name: 'Mount Hakodate Ropeway',
                nameLocal: 'ÂáΩÈ§®Â±±„É≠„Éº„Éó„Ç¶„Çß„Ç§',
                category: 'Landscape/Nature',
                region: 'Hakodate Area',
                coords: [41.7581, 140.7022],
                dates: 'Day 3 evening',
                bestTime: 'Arrive 30min before sunset',
                admission: '¬•1,800 round trip (~$12)',
                permits: 'Tripod may require permission',
                features: "Called the 'Million Dollar Night View'. Michelin gave it 3 stars. The city lights are pinched between two dark bays, creating an hourglass shape. Winter is actually peak season because the air is clearer.",
                notes: "It's a 3-minute cable car ride to the 334m summit. Gets crowded at sunset. Arrive 30 minutes early. There's a heated observation deck and a restaurant at the top. Tripods might need permission.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.7581,140.7022',
                readMoreUrl: 'https://334.co.jp/en/',
                readMoreSource: 'Mt. Hakodate Ropeway',
                priority: 'High',
                recommendation: "HIGH PRIORITY. This is your Day 2 hero shot. Arrive 30 minutes before sunset. BIG CAVEAT: If it's too windy, they close the ropeway, and there's no backup way up (the mountain road is closed in winter). Mt. Moiwa later in the trip is your insurance policy.",
                recommendationType: 'recommended'
            },
            {
                name: 'Hakodate Morning Market',
                nameLocal: 'ÂáΩÈ§®ÊúùÂ∏Ç',
                category: 'Food/Culture',
                region: 'Hakodate Area',
                coords: [41.7731, 140.7281],
                dates: 'Day 4 early morning',
                bestTime: 'Dawn to 9:00 AM',
                admission: 'Free entry; food ¬•500-3,000',
                permits: 'Ask individual vendors',
                features: "Huge fish market right next to the train station. About 250 shops. The hook: there's a pond where you fish for live squid, and they prepare it as sashimi right there. Like, still-moving fresh.",
                notes: "Opens around 6am in winter. Go early (before 7am) for the best selection. The live squid fishing is the visual. That's what you're here for.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.7731,140.7281',
                readMoreUrl: 'https://www.japan-guide.com/e/e5353.html',
                readMoreSource: 'Japan Guide',
                priority: 'High',
                recommendation: "HIGH PRIORITY. Day 3 early morning. The live squid fishing is the content. Get there before 7am.",
                recommendationType: 'recommended'
            },
            {
                name: 'Motomachi Historic District',
                nameLocal: 'ÂÖÉÁî∫',
                category: 'Architecture',
                region: 'Hakodate Area',
                coords: [41.7650, 140.7108],
                dates: 'Day 4 morning/afternoon',
                bestTime: 'Morning for churches, afternoon for harbor',
                admission: 'Free (some buildings charge entry)',
                permits: 'No for exteriors',
                features: "Hakodate was one of the first Japanese ports opened to foreign trade in the 1850s, so you get this unusual mix of Japanese and Western architecture. Hilly cobblestone streets, Russian Orthodox churches, European-style buildings, ocean views.",
                notes: "There's a slope called Hachimanzaka that's a famous photo spot. The East-meets-West architecture tells a story about Japan's history of opening to the world.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.7650,140.7108',
                readMoreUrl: 'https://www.japan.travel/en/spot/1902/',
                readMoreSource: 'JNTO',
                priority: 'Medium',
                recommendation: "RECOMMENDED. Good Day 2 afternoon walking content. The architecture tells a story. Combine with the Orthodox Church nearby.",
                recommendationType: 'recommended'
            },
            {
                name: 'Hakodate Orthodox Church',
                nameLocal: 'ÂáΩÈ§®„Éè„É™„Çπ„Éà„ÇπÊ≠£Êïô‰ºö',
                category: 'Architecture',
                region: 'Hakodate Area',
                coords: [41.7644, 140.7114],
                dates: 'Day 4',
                bestTime: 'Night for dramatic lighting; morning for interior',
                admission: '¬•200 donation (~$1.50)',
                permits: 'No interior filming during services',
                features: "Russian Orthodox church with distinctive white walls and green roof. The bells are designated as one of 'Japan's 100 Sounds.'",
                notes: "Part of the Motomachi walking route. No filming inside during services. The Russian influence in Hokkaido is an interesting angle.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.7644,140.7114',
                priority: 'Medium',
                recommendation: "CONDITIONAL. Include if you're doing the Motomachi walking segment anyway. Skip if Day 2 is running behind schedule.",
                recommendationType: 'conditional'
            },
            {
                name: 'Goryokaku Fort & Tower',
                nameLocal: '‰∫îÁ®úÈÉ≠„Çø„ÉØ„Éº',
                category: 'Architecture',
                region: 'Hakodate Area',
                coords: [41.7964, 140.7569],
                dates: 'Day 4',
                bestTime: 'Morning for tower views; dusk for illumination',
                admission: 'Tower ¬•1,000 (~$7); Fort grounds free',
                permits: 'No',
                features: "A star-shaped Western-style fort from 1866. You can only really see the star shape from the observation tower (107m high). It's where the last battle of Japan's civil war happened.",
                notes: "The tower costs about $7. In winter, the snow creates this stark geometric contrast that photographs well. There's some history about Japan's transition to the modern era if you want that angle.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.7964,140.7569',
                readMoreUrl: 'https://www.japan-guide.com/e/e5352.html',
                readMoreSource: 'Japan Guide',
                priority: 'Medium',
                recommendation: "CONDITIONAL. Cool aerial view of the star shape, but not essential to the episode. Include if Day 2 timing allows, skip if you're running tight.",
                recommendationType: 'conditional'
            },
            {
                name: 'Kanemori Red Brick Warehouse',
                nameLocal: 'ÈáëÊ£ÆËµ§„É¨„É≥„Ç¨ÂÄâÂ∫´',
                category: 'Architecture',
                region: 'Hakodate Area',
                coords: [41.7689, 140.7156],
                dates: 'Day 4',
                bestTime: 'Blue hour/night for reflections',
                admission: 'Free entry; shops inside',
                permits: 'No for exteriors',
                features: "Old warehouse district from 1869, now a Hokkaido Heritage Site. Red bricks, white snow, bay in the background. They light it up at night.",
                notes: "Waterfront location. Good for a shopping/coffee break. Nice atmosphere B-roll.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.7689,140.7156',
                readMoreUrl: 'https://hakodate-kanemori.com/en',
                readMoreSource: 'Kanemori',
                priority: 'Low',
                recommendation: "LOW PRIORITY. Nice B-roll at blue hour, but not a story driver. Skip if you're pressed for time.",
                recommendationType: 'conditional'
            },
            {
                name: 'Yunokawa Onsen - Hot Spring Monkeys',
                nameLocal: 'ÊπØ„ÅÆÂ∑ùÊ∏©Ê≥â ÁÜ±Â∏ØÊ§çÁâ©Âúí',
                category: 'Wildlife',
                region: 'Hakodate Area',
                coords: [41.7831, 140.8039],
                dates: 'Day 4 afternoon',
                bestTime: 'Midday when monkeys most active',
                admission: '¬•300 (~$2)',
                permits: 'No',
                features: "Japanese macaques (wild monkeys) bathing in their own hot spring pool. This only happens December to May. It's like the famous Nagano snow monkeys but way less crowded.",
                notes: "Only $2 admission. About 5 minutes from Hakodate Airport, 20 minutes by streetcar from Hakodate Station. Monkeys in a hot spring = instant visual.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=41.7831,140.8039',
                readMoreUrl: 'https://www.visit-hokkaido.jp/en/spot/detail_10162.html',
                readMoreSource: 'Visit Hokkaido',
                priority: 'High',
                recommendation: "HIGH PRIORITY. Monkeys. In a hot spring. In the snow. This is easy visual content and it's cheap. Hit it Day 2 afternoon before the ropeway.",
                recommendationType: 'recommended'
            },
            {
                name: 'Onuma Quasi-National Park',
                nameLocal: 'Â§ßÊ≤ºÂõΩÂÆöÂÖ¨Âúí',
                category: 'Winter Activity',
                region: 'Hakodate Area',
                coords: [41.9889, 140.6653],
                dates: 'Day 5',
                bestTime: 'Morning for activities; afternoon for Mt. Komagatake',
                admission: 'Free entry; Activities ¬•600-3,000',
                permits: 'No - book activities with operators',
                features: "In winter, the lake freezes and becomes a playground. You can do wakasagi ice fishing. Drill a hole, catch tiny fish, eat them as tempura. There are also horse-drawn sleigh rides across the frozen lake and snowmobiling.",
                notes: "About 25 minutes from Hakodate by train. The ice fishing includes rod rental, bait, and cooking. The sleigh ride is about 2km across the ice.",
                unesco: false,
                nationalPark: true,
                mapsUrl: 'https://maps.google.com/?q=41.9889,140.6653',
                readMoreUrl: 'https://www.japan-guide.com/e/e5356.html',
                readMoreSource: 'Japan Guide',
                priority: 'High',
                recommendation: "CONDITIONAL. Ice fishing and sleigh rides are good winter content, but it's a 50-minute round trip from Hakodate. Only worth it if you have a slow Day 3 morning with nothing else scheduled.",
                recommendationType: 'conditional'
            },
            {
                name: 'Noboribetsu Hell Valley',
                nameLocal: 'ÁôªÂà•Âú∞ÁçÑË∞∑',
                category: 'Landscape/Nature',
                region: 'Lake Toya-Noboribetsu',
                coords: [42.4933, 141.1478],
                dates: 'Day 5-6',
                bestTime: 'Any - steam is dramatic always; night for illuminated path',
                admission: 'Free; Parking ¬•500',
                permits: 'No - open public area',
                features: "A volcanic crater valley with steam vents everywhere, sulfurous streams, and 10,000+ tons of mineral water pumping out daily. Looks like another planet or, you know, hell.",
                notes: "5-minute walk from the bus terminal. There's a 20-minute loop on boardwalks. They light up a path at night called 'Onibi no Michi.' Demon statues everywhere.",
                unesco: false,
                nationalPark: true,
                mapsUrl: 'https://maps.google.com/?q=42.4933,141.1478',
                readMoreUrl: 'https://www.japan-guide.com/e/e6751.html',
                readMoreSource: 'Japan Guide',
                priority: 'High',
                recommendation: "CONDITIONAL. Dramatic volcanic landscape, but it's not on the direct Hakodate‚ÜíOtaru route. You'd need to detour. Decision needed: is the visual worth the extra travel time?",
                recommendationType: 'conditional'
            },
            {
                name: 'Oyunuma Pond & Natural Footbath',
                nameLocal: 'Â§ßÊπØÊ≤º',
                category: 'Onsen/Hot Spring',
                region: 'Lake Toya-Noboribetsu',
                coords: [42.4978, 141.1483],
                dates: 'Day 5-6',
                bestTime: 'Morning for steam effects',
                admission: 'Free',
                permits: 'No',
                features: "A sulfuric pond where the surface temperature is 50¬∞C (122¬∞F). A river flows from it with a natural ashiyu (footbath) along the banks. You just sit and soak your feet in naturally hot water.",
                notes: "About 20-30 minutes' walk from Hell Valley. Trail might be closed in heavy snow. Bring a towel for the footbath.",
                unesco: false,
                nationalPark: true,
                mapsUrl: 'https://maps.google.com/?q=42.4978,141.1483',
                readMoreUrl: 'https://www.japan.travel/en/spot/1908/',
                readMoreSource: 'JNTO',
                priority: 'Medium',
                recommendation: "CONDITIONAL. Only makes sense if you're already doing Noboribetsu. It's an add-on to Hell Valley, not a standalone destination.",
                recommendationType: 'conditional'
            },
            {
                name: 'Lake Toya',
                nameLocal: 'Ê¥ûÁà∫Êπñ',
                category: 'Landscape/Nature',
                region: 'Lake Toya-Noboribetsu',
                coords: [42.6103, 140.8567],
                dates: 'Day 6',
                bestTime: 'Morning for Mount Yotei reflections',
                admission: 'Free',
                permits: 'No',
                features: "A caldera lake (formed from a collapsed volcano) with views of Mount Yotei, which they call 'Hokkaido's Fuji' because it looks like a smaller Mt. Fuji. Semi-frozen in winter. The lakeside town has winter fireworks.",
                notes: "Between Noboribetsu and Niseko. There are lake cruises year-round and free footbaths along the waterfront promenade.",
                unesco: false,
                nationalPark: true,
                mapsUrl: 'https://maps.google.com/?q=42.6103,140.8567',
                readMoreUrl: 'https://www.japan-guide.com/e/e6725.html',
                readMoreSource: 'Japan Guide',
                priority: 'Medium',
                recommendation: "CONDITIONAL. It's a UNESCO Global Geopark with nice views, but only makes sense if you're routing through the Noboribetsu area. Not essential on its own.",
                recommendationType: 'conditional'
            },
            {
                name: 'Mount Yotei',
                nameLocal: 'ÁæäËπÑÂ±±',
                category: 'Landscape/Nature',
                region: 'Lake Toya-Noboribetsu',
                coords: [42.8264, 140.8119],
                dates: 'Day 6 (views from multiple locations)',
                bestTime: 'Clear morning for sunrise on peak',
                admission: 'Free (viewing)',
                permits: 'No',
                features: "A 1,898m perfectly symmetrical volcanic cone that looks like Mt. Fuji's little brother. Snow-capped in winter. You can see it from Niseko, Rusutsu, and Lake Toya.",
                notes: "You can't climb it in winter. This is views only. You need a clear day. Sunrise and sunset create nice light on the peak.",
                unesco: false,
                nationalPark: true,
                mapsUrl: 'https://maps.google.com/?q=42.8264,140.8119',
                readMoreUrl: 'https://en.japantravel.com/places/hokkaido/mount-yotei/695',
                readMoreSource: 'JapanTravel.com',
                priority: 'Medium',
                recommendation: "CONDITIONAL. Background scenery only (not climbable in winter). Get some shots if you're in the area on a clear day.",
                recommendationType: 'conditional'
            },
            {
                name: 'Showa Shinzan',
                nameLocal: 'Êò≠ÂíåÊñ∞Â±±',
                category: 'Landscape/Nature',
                region: 'Lake Toya-Noboribetsu',
                coords: [42.5428, 140.8583],
                dates: 'Day 6',
                bestTime: 'Any - steam always visible',
                admission: 'Free viewing; Usuzan Ropeway ¬•1,800',
                permits: 'No',
                features: "A 'young volcano' that literally didn't exist until 1943. It grew during WWII and is still growing about 30cm per year. You can feel the warmth from the ground at the base.",
                notes: "Right next to a ropeway (Usuzan Ropeway). About 15 minutes from Lake Toya. The ground is actually warm to the touch.",
                unesco: false,
                nationalPark: true,
                mapsUrl: 'https://maps.google.com/?q=42.5428,140.8583',
                readMoreUrl: 'https://www.japan-guide.com/e/e6725.html',
                readMoreSource: 'Japan Guide',
                priority: 'Medium',
                recommendation: "CONDITIONAL. Cool geology story (a volcano that's younger than our parents), but only if you're doing the Lake Toya route. Not worth a special trip.",
                recommendationType: 'conditional'
            },
            {
                name: 'Otaru Canal',
                nameLocal: 'Â∞èÊ®ΩÈÅãÊ≤≥',
                category: 'Architecture',
                region: 'Otaru',
                coords: [43.1972, 141.0028],
                dates: 'Day 6-7',
                bestTime: 'Blue hour/night for gas lamp reflections',
                admission: 'Free',
                permits: 'No',
                features: "Historic canal lined with old stone warehouses and gas lamps. Very romantic, especially at night with snow falling and the lamps glowing.",
                notes: "10-minute walk from Otaru Station. This is the most photographed spot in Otaru. Sushi Street is nearby.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.1972,141.0028',
                readMoreUrl: 'https://www.japan-guide.com/e/e6701.html',
                readMoreSource: 'Japan Guide',
                priority: 'Medium',
                recommendation: "RECOMMENDED. Day 3 evening. The classic Otaru shot is the canal with gas lamps and snow. Best at blue hour or night.",
                recommendationType: 'recommended'
            },
            {
                name: 'Otaru Sushi Street',
                nameLocal: 'Â∞èÊ®ΩÂØøÂè∏Â±ãÈÄö„Çä',
                category: 'Food/Culture',
                region: 'Otaru',
                coords: [43.1950, 140.9975],
                dates: 'Day 6-7',
                bestTime: 'Lunch (11:30 AM - 2:00 PM)',
                admission: '¬•2,000-5,000 per meal',
                permits: 'Ask restaurant permission',
                features: "A whole street of sushi restaurants serving ultra-fresh Hokkaido seafood. Sea urchin, salmon roe, crab. Hokkaido seafood is noticeably sweeter and richer than elsewhere in Japan.",
                notes: "Right near the canal area. The uni (sea urchin) here is particularly famous. Just pick a place that looks good.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.1950,140.9975',
                readMoreUrl: 'https://www.japan-guide.com/e/e6701.html',
                readMoreSource: 'Japan Guide',
                priority: 'Medium',
                recommendation: "RECOMMENDED. Day 3 dinner. This is your fresh Hokkaido seafood story. Don't overthink the restaurant choice.",
                recommendationType: 'recommended'
            },
            {
                name: 'Otaru Station',
                nameLocal: 'Â∞èÊ®ΩÈßÖ',
                category: 'Transport Hub',
                region: 'Otaru',
                coords: [43.1972, 141.0028],
                dates: 'Days 3-4 (March 4-5)',
                bestTime: 'Arrival late afternoon',
                admission: 'Free',
                permits: 'No',
                features: "Small, charming station in the canal town. The famous canal and sushi street are walking distance. Glass workshops and music box museum nearby.",
                notes: "Day 3 arrival, canal at night. Day 4 ski day at Asari (15 min by Uber/taxi), then evening train to Sapporo (30 min).",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.1972,141.0028',
                priority: 'High',
                recommendation: "REQUIRED STOP. Day 3-4 hub.",
                recommendationType: 'recommended'
            },
            {
                name: 'Asari Ski Resort',
                nameLocal: 'ÊúùÈáåÂ∑ùÊ∏©Ê≥â„Çπ„Ç≠„ÉºÂ†¥',
                category: 'Winter Activity',
                region: 'Otaru',
                coords: [43.1667, 141.0333],
                dates: 'Day 4 (ski day option)',
                bestTime: 'Morning for fresh snow; afternoon for ocean views',
                admission: 'Day pass ¬•3,500-4,000 (~$24-27)',
                permits: 'No for personal; contact for commercial',
                features: "Local ski resort just 15 minutes from Otaru. You get ocean views from the slopes. There's an onsen right next door for apr√®s-ski. Way less crowded than Niseko.",
                notes: "15 min by Uber/taxi from central Otaru. It's smaller than Niseko but fits the schedule better. 9 courses, longest run is 890m.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.1667,141.0333',
                readMoreUrl: 'https://www.snowjapan.com/japan-ski-resorts/hokkaido/otaru/asari',
                readMoreSource: 'SnowJapan',
                priority: 'Medium',
                recommendation: "RECOMMENDED (DEFAULT). Day 4 ski content. 15 minutes from Otaru, ocean views, onsen next door. Less impressive than Niseko but fits the schedule. This is the current plan unless Jaron wants to upgrade.",
                recommendationType: 'recommended'
            },
            {
                name: 'Sapporo Station',
                nameLocal: 'Êú≠ÂπåÈßÖ',
                category: 'Transport Hub',
                region: 'Sapporo',
                coords: [43.0686, 141.3508],
                dates: 'Days 4-7 (March 5-8)',
                bestTime: 'Any',
                admission: 'Free',
                permits: 'No',
                features: "Your final hub. Big modern station with shopping and restaurants. Subway and JR lines connect here. Beer Museum shuttle departs nearby.",
                notes: "You're based here for 3 nights. Most Sapporo locations are Uber/taxi or subway rides away. Day 7 you take the JR Airport Express to New Chitose (37 min).",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0686,141.3508',
                readMoreUrl: 'https://en.wikipedia.org/wiki/Sapporo_Station',
                readMoreSource: 'Wikipedia',
                priority: 'High',
                recommendation: "REQUIRED STOP. Days 5-7 hub.",
                recommendationType: 'recommended'
            },
            {
                name: 'New Chitose Airport',
                nameLocal: 'Êñ∞ÂçÉÊ≠≥Á©∫Ê∏Ø',
                category: 'Transport Hub',
                region: 'Sapporo',
                coords: [42.7752, 141.6925],
                dates: 'Day 7 (March 8)',
                bestTime: 'Morning departure',
                admission: 'Free',
                permits: 'No',
                features: "Sapporo's main airport. Surprisingly fun for an airport: there's a hot spring bath, a Royce chocolate factory tour, and a ramen food court if you have time to kill.",
                notes: "37 min by JR Airport Express from Sapporo Station (~¬•1,150). Flight to Tokyo Haneda is about 1.5 hours. Could grab some last-minute content at the chocolate factory or ramen court if the schedule allows.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=42.7752,141.6925',
                priority: 'Medium',
                recommendation: "DEPARTURE POINT. Day 7 exit.",
                recommendationType: 'recommended'
            },
            {
                name: 'Odori Park',
                nameLocal: 'Â§ßÈÄöÂÖ¨Âúí',
                category: 'Landscape/Nature',
                region: 'Sapporo',
                coords: [43.0603, 141.3544],
                dates: 'Day 7-8',
                bestTime: 'Daytime for park strolls; evening for illuminated TV Tower views',
                admission: 'Free',
                permits: 'No permits required',
                features: "A 1.5km urban park running through the center of Sapporo, spanning 12 blocks. Tree-lined paths, flower beds, and the TV Tower at one end. Where locals hang out.",
                notes: "Good central meeting point or transition spot between locations. Multiple cafes along the park. In March you'll still have late-winter atmosphere with possible snow.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0603,141.3544',
                readMoreUrl: 'https://en.wikipedia.org/wiki/Odori_Park',
                readMoreSource: 'Wikipedia',
                priority: 'High',
                recommendation: "RECOMMENDED. Central park, good for establishing shots and transitions. TV Tower is at the east end.",
                recommendationType: 'recommended'
            },
            {
                name: 'Sapporo TV Tower',
                nameLocal: '„Åï„Å£„ÅΩ„Çç„ÉÜ„É¨„ÉìÂ°î',
                category: 'Architecture',
                region: 'Sapporo',
                coords: [43.0611, 141.3567],
                dates: 'Day 7-8',
                bestTime: 'Dusk for city lights transition',
                admission: '¬•1,000 (~$7)',
                permits: 'No',
                features: "147m tower at the east end of Odori Park. Observation deck at 90m with 360-degree city views.",
                notes: "Night photography of the park from above is nice. On clear days you can see the mountains.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0611,141.3567',
                readMoreUrl: 'https://en.wikipedia.org/wiki/Sapporo_TV_Tower',
                readMoreSource: 'Wikipedia',
                priority: 'Low',
                recommendation: "LOW PRIORITY. It's a standard city observation deck. Skip unless you need filler content.",
                recommendationType: 'conditional'
            },
            {
                name: 'Sapporo Beer Museum',
                nameLocal: '„Çµ„ÉÉ„Éù„É≠„Éì„Éº„É´ÂçöÁâ©È§®',
                category: 'Food/Culture',
                region: 'Sapporo',
                coords: [43.0697, 141.3653],
                dates: 'Day 8',
                bestTime: 'Afternoon for tours; evening for beer garden',
                admission: 'Free museum; Tasting ¬•500-800',
                permits: 'Contact for filming permission',
                features: "Japan's only beer museum. Covers the history of Sapporo Beer, which was founded in 1876. The beer hall serves Genghis Khan (lamb BBQ) plus beer.",
                notes: "15-minute walk from Sapporo Station. English audio guide available. Opens at 11am, not 10am.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0697,141.3653',
                readMoreUrl: 'https://www.sapporo.travel/en/spot/facility/sapporo-beer-museum/',
                readMoreSource: 'SAPPORO TRAVEL',
                priority: 'Medium',
                recommendation: "HIGH PRIORITY. Day 5 core content. Japan's only beer museum. Contact them for filming permission.",
                recommendationType: 'recommended'
            },
            {
                name: 'Nijo Market',
                nameLocal: '‰∫åÊù°Â∏ÇÂ†¥',
                category: 'Food/Culture',
                region: 'Sapporo',
                coords: [43.0581, 141.3506],
                dates: 'Day 8 morning',
                bestTime: 'Early morning (6:00-9:00 AM)',
                admission: 'Free entry; food ¬•500-3,000',
                permits: 'Ask vendor permission',
                features: "A century-old fish market right in the city center. Tsukko Meshi (salmon roe rice bowl) was invented here.",
                notes: "Opens early. Some stalls by 6am. Walking distance from Odori Park. Feels more local than the Hakodate market.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0581,141.3506',
                readMoreUrl: 'https://www.japan-guide.com/e/e5310.html',
                readMoreSource: 'Japan Guide',
                priority: 'Medium',
                recommendation: "CONDITIONAL. Less touristy than Hakodate's market. Only worth including if you want a second market segment, otherwise skip.",
                recommendationType: 'conditional'
            },
            {
                name: 'Ganso Sapporo Ramen Yokocho',
                nameLocal: 'ÂÖÉÁ•ñ„Åï„Å£„ÅΩ„Çç„É©„Éº„É°„É≥Ê®™‰∏Å',
                category: 'Food/Culture',
                region: 'Sapporo',
                coords: [43.0547, 141.3533],
                dates: 'Day 8 dinner',
                bestTime: 'Evening (6:00-10:00 PM)',
                admission: '¬•800-1,500 per bowl',
                permits: 'Ask individual shops',
                features: "The birthplace of miso ramen. 17 tiny ramen shops crammed into a narrow alley. Perfect for cold weather.",
                notes: "In the Susukino district. Each shop has maybe 8-10 seats. Corn butter ramen is the local specialty.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0547,141.3533',
                readMoreUrl: 'https://www.ramen-yokocho.com/en/',
                readMoreSource: 'Ramen Yokocho',
                priority: 'High',
                recommendation: "RECOMMENDED. The birthplace of miso ramen. 17 tiny shops in an alley. Good evening content in Susukino.",
                recommendationType: 'recommended'
            },
            {
                name: 'Susukino Entertainment District',
                nameLocal: '„Åô„Åô„Åç„ÅÆ',
                category: 'Food/Culture',
                region: 'Sapporo',
                coords: [43.0536, 141.3525],
                dates: 'Day 8 night',
                bestTime: 'Night (8:00 PM onwards)',
                admission: 'Varies by venue',
                permits: 'No for street filming',
                features: "Japan's northernmost entertainment district. Neon lights, izakayas, bars, karaoke. It's safe despite being an entertainment district.",
                notes: "Bar Yamazaki is the oldest whisky bar. Good for nightlife B-roll. Connects to Ramen Alley.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0536,141.3525',
                readMoreUrl: 'https://en.wikipedia.org/wiki/Susukino',
                readMoreSource: 'Wikipedia',
                priority: 'Low',
                recommendation: "CONDITIONAL. Night B-roll of neon lights. Not a story driver, but good atmosphere content if you need it.",
                recommendationType: 'conditional'
            },
            {
                name: 'Niseko United Ski Resort',
                nameLocal: '„Éã„Çª„Ç≥„É¶„Éä„Ç§„ÉÜ„ÉÉ„Éâ',
                category: 'Winter Activity',
                region: 'Niseko-Rusutsu',
                coords: [42.8633, 140.7000],
                dates: 'Optional extension',
                bestTime: 'Morning for fresh powder',
                admission: 'Day pass ¬•7,500-8,500 (~$50-57)',
                permits: 'Media accreditation for commercial filming',
                features: "Japan's most famous international ski resort. 590 inches of ultra-dry powder annually. Four interconnected resorts. Very international crowd.",
                notes: "2-2.5 hours from Sapporo. Peak season is January-February. Grand Hirafu has the most nightlife.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=42.8633,140.7000',
                readMoreUrl: 'https://www.outsideonline.com/adventure-travel/destinations/asia/niseko-japans-mythical-powder-paradise/',
                readMoreSource: 'Outside Magazine',
                priority: 'Medium',
                recommendation: "CONDITIONAL. World-class powder skiing, but it's 2-2.5 hours from Sapporo. Higher production value than Asari, but eats into the schedule. Decision: casual ski day vs. destination ski content?",
                recommendationType: 'conditional'
            },
            {
                name: 'Rusutsu Resort',
                nameLocal: '„É´„Çπ„ÉÑ„É™„Çæ„Éº„Éà',
                category: 'Winter Activity',
                region: 'Niseko-Rusutsu',
                coords: [42.7489, 140.9003],
                dates: 'Optional extension',
                bestTime: 'Any - less crowded than Niseko',
                admission: 'Day pass ¬•6,500 (~$44)',
                permits: 'Media accreditation for commercial filming',
                features: "Often rated Hokkaido's best ski resort. 550 inches of powder. Less crowded than Niseko. Fantastic tree skiing.",
                notes: "More local/Japanese feel. The powder lasts longer because there are fewer people. Three mountains. 20-30 minutes from Niseko.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=42.7489,140.9003',
                readMoreUrl: 'https://www.japan.travel/en/spot/1906/',
                readMoreSource: 'JNTO',
                priority: 'Medium',
                recommendation: "CONDITIONAL. Often rated better than Niseko, and less crowded. Same schedule trade-off though. Only makes sense if you're committing to destination ski content.",
                recommendationType: 'conditional'
            },
            {
                name: 'Mount Moiwa Ropeway',
                nameLocal: 'ËóªÂ≤©Â±±„É≠„Éº„Éó„Ç¶„Çß„Ç§',
                category: 'Landscape/Nature',
                region: 'Sapporo',
                coords: [43.0317, 141.3331],
                dates: 'Day 5-7 (March 6-8)',
                bestTime: 'Sunset/Evening (arrive 1hr before sunset; last ropeway 9:30pm)',
                admission: '¬•2,100 roundtrip (~$14)',
                permits: 'No',
                features: "One of Japan's 'New Top 3 Night Views' (awarded 2015). 531m summit with 360¬∞ views. Ropeway plus a cute mini cable car called the 'Morris Car.' French restaurant at the top.",
                notes: "15-20 min by Uber/taxi from downtown Sapporo. Summit observatory is heated. There's a 'Bell of Happiness' with love locks for B-roll. It's an Ainu sacred mountain.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0317,141.3331',
                readMoreUrl: 'https://www.japan.travel/en/spot/1855/',
                readMoreSource: 'JNTO',
                priority: 'High',
                recommendation: "HIGH PRIORITY. Day 5 or 6 evening. Backup if Hakodate got weathered out, OR do a 'which night view is better?' comparison. Last ropeway up is 9:30pm.",
                recommendationType: 'recommended'
            },
            {
                name: 'Jozankei Onsen',
                nameLocal: 'ÂÆöÂ±±Ê∏ìÊ∏©Ê≥â',
                category: 'Onsen/Hot Spring',
                region: 'Sapporo',
                coords: [42.9697, 141.1667],
                dates: 'Day 7-8 (optional half-day trip)',
                bestTime: 'Afternoon to evening; fall foliage famous but winter has snow-covered gorge',
                admission: 'Free to walk; Ryokan day-use ¬•1,000-2,000',
                permits: 'No',
                features: "Hokkaido's largest hot spring town. 2.4 million visitors per year. 56 natural sources pumping 8,600 liters per minute. Scenic river gorge with kappa (water spirit) statues everywhere.",
                notes: "50 minutes by bus from Sapporo Station (Jotetsu Bus, ¬•800). Multiple foot baths along the river walk. Less touristy than Noboribetsu.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=42.9697,141.1667',
                readMoreUrl: 'https://www.japan.travel/en/spot/1934/',
                readMoreSource: 'JNTO',
                priority: 'Medium',
                recommendation: "LOW PRIORITY. Nice half-day escape with quirky kappa statues, but not essential. Only if Day 6 has dead time.",
                recommendationType: 'conditional'
            },
            {
                name: 'Historical Village of Hokkaido',
                nameLocal: 'ÂåóÊµ∑ÈÅìÈñãÊãì„ÅÆÊùë',
                category: 'Architecture',
                region: 'Sapporo',
                coords: [43.0528, 141.4889],
                dates: 'Day 5-7 (March 6-8)',
                bestTime: 'Morning to midday (9am-3pm)',
                admission: '¬•1,000 (~$7)',
                permits: 'No for standard; contact for commercial',
                features: "54-hectare open-air museum with 52 historic buildings from the Meiji/Taisho periods. In winter they do horse-drawn sleigh rides (¬•250). Golden Kamuy filming locations. Snow-covered buildings look even better than in summer.",
                notes: "25 min by Uber/taxi from downtown Sapporo. Allow 2-3 hours. Interiors are heated. Cafeteria has imo mochi and nishin soba. Closed Mondays.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0528,141.4889',
                readMoreUrl: 'https://www.atlasobscura.com/places/historical-village-of-hokkaido-japan',
                readMoreSource: 'Atlas Obscura',
                priority: 'High',
                recommendation: "RECOMMENDED. Day 6 morning. 52 historic buildings plus winter sleigh rides. Golden Kamuy connection for anime fans. Closed Mondays (we're there Saturday so no issue).",
                recommendationType: 'recommended'
            },
            {
                name: 'Soup Curry GARAKU',
                nameLocal: '„Çπ„Éº„Éó„Ç´„É™„ÉºGARAKU',
                category: 'Food/Culture',
                region: 'Sapporo',
                coords: [43.0567, 141.3506],
                dates: 'Day 5-7 (March 6-8)',
                bestTime: 'Dinner (5pm-11:30pm) for atmosphere',
                admission: '¬•1,100-1,500 (~$7-10)',
                permits: 'No for personal; ask for commercial',
                features: "One of Sapporo's most famous soup curry spots. Their signature is a whole chicken leg in the curry. 30 ingredients, 21 spices, no MSG. You can customize the spice level from 1-40.",
                notes: "Between Odori and Susukino stations, basement level. Expect 30-60+ minute lines. They have a numbered ticket system. English menu, tablet ordering.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0567,141.3506',
                readMoreUrl: 'https://www.gltjp.com/en/directory/item/13955/',
                readMoreSource: 'GLTJP',
                priority: 'Medium',
                recommendation: "CONDITIONAL. Tourist favorite, but the lines are 30-60 minutes. Consider Ajanta instead for the 'birthplace of soup curry' story.",
                recommendationType: 'conditional'
            },
            {
                name: 'Ajanta Indo Curry',
                nameLocal: '„Ç¢„Ç∏„É£„É≥„ÇøÁ∑èÊú¨ÂÆ∂',
                category: 'Food/Culture',
                region: 'Sapporo',
                coords: [43.0853, 141.3567],
                dates: 'Day 5-7 (March 6-8)',
                bestTime: 'Lunch (less crowded)',
                admission: '¬•1,500-2,000 (~$10-13)',
                permits: 'No for personal',
                features: "THE BIRTHPLACE of soup curry (1971). Founded by Tatsujiri Muneo, who created 'Yakuzen Curry' (medicinal curry). Still true to the original herbal style. Open kitchen at the counter.",
                notes: "10 min by Uber/taxi from downtown Sapporo. In a residential area. Way less touristy than GARAKU. You can't choose your spice level. This is a pilgrimage to where soup curry was invented.",
                unesco: false,
                nationalPark: false,
                birthplace: 'Soup Curry',
                mapsUrl: 'https://maps.google.com/?q=43.0853,141.3567',
                readMoreUrl: 'https://culinarybackstreets.com/cities-category/tokyo/2023/hokkaido-soup-curry-2/',
                readMoreSource: 'Culinary Backstreets',
                priority: 'High',
                recommendation: "HIGH PRIORITY. Day 5 afternoon. THE birthplace of soup curry (1971). Less touristy than GARAKU. This is the 'pilgrimage to where it was invented' story.",
                recommendationType: 'recommended'
            },
            {
                name: 'Sapporo Beer Garden',
                nameLocal: '„Çµ„ÉÉ„Éù„É≠„Éì„Éº„É´Âúí',
                category: 'Food/Culture',
                region: 'Sapporo',
                coords: [43.0708, 141.3789],
                dates: 'Day 5-7 (March 6-8)',
                bestTime: 'Dinner (evening atmosphere best)',
                admission: '¬•3,400-7,500 all-you-can-eat (~$22-50)',
                permits: 'Photo OK in halls; ask for commercial',
                features: "Historic 1890 red brick brewery. The Kessel Hall has a 1912 copper kettle. They serve 'Sapporo Five Star' beer that you can only get here. All-you-can-eat Jingisukan (lamb BBQ) plus unlimited beer.",
                notes: "Shuttle from Sapporo Station (10 min, ¬•210) or walk from JR Naebo (7 min). Reservations recommended. Story angle: 'Why does Hokkaido eat lamb when the rest of Japan doesn't?'",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=43.0708,141.3789',
                readMoreUrl: 'https://www.sapporo.travel/en/spot/facility/sapporo-beer-garden/',
                readMoreSource: 'SAPPORO TRAVEL',
                priority: 'High',
                recommendation: "HIGH PRIORITY. Day 5 lunch. Jingisukan (lamb BBQ) plus beer experience. Book a reservation now.",
                recommendationType: 'recommended'
            },
            {
                name: 'IWACHU Ironware Museum',
                nameLocal: 'Â≤©Èã≥ÈâÑÂô®È§®',
                category: 'Craft/Culture',
                region: 'Tohoku',
                coords: [39.6714, 141.1536],
                dates: 'Day 1 (March 2)',
                bestTime: '10:00am - 5:00pm (closed Tuesdays); weekdays best for watching artisans',
                admission: 'Free',
                permits: 'No for personal; ask for commercial',
                features: "Japan's largest Nanbu Ironware producer, operating since 1902. You can watch artisans doing casting, mold-making, and lacquer work. This is a 400-year-old craft. 65 processes per kettle, 15 years to master.",
                notes: "15-20 min by Uber/taxi from Morioka Station, or 20-30 min by bus + short walk. Contact IWACHU in advance for casting/pouring schedule and filming access. They say the kettles make water taste softer, reduce chlorine, and release iron into the water.",
                unesco: false,
                nationalPark: false,
                livingCraft: true,
                mapsUrl: 'https://maps.google.com/?q=39.6714,141.1536',
                readMoreUrl: 'https://www.nationalgeographic.com/travel/article/artisan-crafts-talismans-tohoku-japan',
                readMoreSource: 'National Geographic',
                priority: 'High',
                recommendation: "HIGH PRIORITY. Core Day 1 craft content. Free admission. Contact them ahead of time to confirm hours and ask about seeing the casting process.",
                recommendationType: 'recommended'
            },
            {
                name: 'Shokudoen',
                nameLocal: 'È£üÈÅìÂúí',
                category: 'Food/Culture',
                region: 'Tohoku',
                coords: [39.7000, 141.1550],
                dates: 'Day 1 (March 2)',
                bestTime: 'Lunch or Dinner (pairs with yakiniku)',
                admission: '¬•950-1,000 (~$6-7)',
                permits: 'No for personal',
                features: "THE BIRTHPLACE of Morioka Reimen (1954). Founded by Korean immigrant Teruhito Aoki. Chewy potato starch noodles in cold beef/chicken broth with seasonal fruit on top. They also have high-quality yakiniku.",
                notes: "10-15 min walk from Morioka Station (World In GEN Plaza 2F). Lunch 11:30am-3pm, Dinner 5pm-11pm. The story here is Korean immigration and flavors adapted over 70 years. One of the 'Three Great Noodles of Morioka.'",
                unesco: false,
                nationalPark: false,
                birthplace: 'Morioka Reimen',
                mapsUrl: 'https://maps.google.com/?q=39.7000,141.1550',
                readMoreUrl: 'https://www.japantimes.co.jp/life/2021/01/16/food/morioka-noodles/',
                readMoreSource: 'Japan Times',
                priority: 'High',
                recommendation: "HIGH PRIORITY. Day 1 food origin story (Korean immigrant narrative). Quick stop, cheap. Part of the 'three noodles of Morioka' challenge.",
                recommendationType: 'recommended'
            },
            {
                name: 'Pairon Honten',
                nameLocal: 'ÁôΩÈæçÊú¨Â∫ó',
                category: 'Food/Culture',
                region: 'Tohoku',
                coords: [39.702286, 141.152167],
                dates: 'Day 1 (March 2)',
                bestTime: 'Lunch or early dinner (branch-dependent)',
                admission: '¬•730 (medium) + ¬•50 Chitantan (~$5-6)',
                permits: 'No for personal',
                features: "Where the famous dish Morioka Jajamen was invented about 70 years ago. Flat udon-like noodles with a secret meat miso sauce that contains over 15 ingredients. There's a unique ritual: crack a raw egg into the remaining sauce, add broth, and you get 'Chitantan' finishing soup.",
                notes: "Main store is a 25-minute walk from the station, OR there's a Fesan branch in the station building. Very small seating. Expect crowds. The story is that this is the second of the 'three noodles of Morioka' challenge.",
                unesco: false,
                nationalPark: false,
                birthplace: 'Morioka Jajamen',
                mapsUrl: 'https://maps.google.com/?q=39.702286,141.152167',
                readMoreUrl: 'https://www.japantimes.co.jp/life/2021/01/16/food/morioka-noodles/',
                readMoreSource: 'Japan Times',
                priority: 'High',
                recommendation: "HIGH PRIORITY. Day 1 interactive content (the Chitantan egg ritual is great on camera). Station branch is most convenient but the main location will be the more authentic experience.",
                recommendationType: 'recommended'
            },
            {
                name: 'Morioka New City Hotel',
                nameLocal: 'ÁõõÂ≤°„Éã„É•„Éº„Ç∑„ÉÜ„Ç£„Éõ„ÉÜ„É´',
                category: 'Lodging',
                region: 'Tohoku',
                coords: [39.70344927562309, 141.1375493923631],
                dates: 'Day 1 (March 2)',
                bestTime: 'Check-in after 3pm',
                admission: '$32/room ($64 for 2 rooms)',
                permits: 'No',
                features: "Budget business hotel in central Morioka. Walking distance to station and Day 1 food stops.",
                notes: "2 rooms needed. Attempt to check-in after arrival, before the noodle crawl.",
                unesco: false,
                nationalPark: false,
                mapsUrl: 'https://maps.google.com/?q=39.70344927562309,141.1375493923631',
                readMoreUrl: 'https://www.hotels.com/ho719174752/morioka-new-city-hotel-morioka-japan/',
                readMoreSource: 'Hotels.com',
                priority: 'High',
                recommendation: "BOOK. Day 1 overnight. Budget business hotel near station.",
                recommendationType: 'recommended'
            }
        ];

        // Transportation segments - station to station connections
        const transportSegments = [
            { from: 'Tokyo Station', to: 'Morioka Station', fromCoords: [35.679183, 139.76716], toCoords: [39.7016, 141.1345], mode: 'Tohoku Shinkansen (Hayabusa)', duration: '2h 10min', cost: '~¬•15,000 (~$100)', date: 'Day 1 (March 2)', notes: 'Depart Tokyo ~9:00 AM, arrive Morioka ~11:15 AM' },
            { from: 'Morioka Station', to: 'Shin-Hakodate-Hokuto Station', fromCoords: [39.7016, 141.1345], toCoords: [41.9044, 140.6478], mode: 'Hokkaido Shinkansen', duration: '2h', cost: '~¬•10,000 (~$67)', date: 'Day 2 (March 3)', notes: 'Through Seikan Tunnel - world\'s longest undersea tunnel' },
            { from: 'Shin-Hakodate-Hokuto Station', to: 'Hakodate Station', fromCoords: [41.9044, 140.6478], toCoords: [41.7731, 140.7281], mode: 'JR Hakodate Liner', duration: '20min', cost: '¬•440', date: 'Day 2 (March 3)' },
            { from: 'Hakodate Station', to: 'Otaru Station', fromCoords: [41.7731, 140.7281], toCoords: [43.1972, 141.0028], mode: 'JR Limited Express + Local', duration: '4-5h', cost: '~¬•8,000 (~$53)', date: 'Day 3 (March 4)', notes: 'Via Sapporo or direct depending on schedule' },
            { from: 'Otaru Station', to: 'Sapporo Station', fromCoords: [43.1972, 141.0028], toCoords: [43.0686, 141.3508], mode: 'JR Rapid', duration: '30min', cost: '¬•750', date: 'Day 4 (March 5)' },
            { from: 'Sapporo Station', to: 'New Chitose Airport', fromCoords: [43.0686, 141.3508], toCoords: [42.7752, 141.6925], mode: 'JR Airport Express', duration: '37min', cost: '¬•1,150', date: 'Day 7 (March 8)', notes: 'Depart for Tokyo Haneda flight' }
        ];

        // Initialize map centered on Hokkaido
        const map = L.map('map', {
            zoomControl: false
        }).setView([41.5, 140.5], 6);

        // Add zoom control to bottom right
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        // Add tile layer
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // Layer groups
        const categoryLayers = {};
        const regionLayer = L.layerGroup();
        const transportLayer = L.layerGroup();

        // Initialize category layers
        Object.keys(categories).forEach(cat => {
            if (cat !== 'Regional Overview') {
                categoryLayers[cat] = L.layerGroup().addTo(map);
            }
        });

        // Create custom marker icon
        function createMarkerIcon(color, priority) {
            const size = priority === 'High' ? 14 : 10;
            const border = priority === 'High' ? 3 : 2;
            return L.divIcon({
                className: 'custom-marker',
                html: `<div style="
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    border: ${border}px solid rgba(255,255,255,0.9);
                    border-radius: 50%;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                "></div>`,
                iconSize: [size + border*2, size + border*2],
                iconAnchor: [(size + border*2)/2, (size + border*2)/2]
            });
        }

        // Create region marker icon
        function createRegionIcon() {
            return L.divIcon({
                className: 'region-marker',
                html: `<div style="
                    width: 24px;
                    height: 24px;
                    background: #ffc107;
                    border: 3px solid rgba(255,255,255,0.9);
                    border-radius: 50%;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 12px;
                ">üìç</div>`,
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });
        }

        // Create location popup content
        function createPopupContent(loc, locIndex) {
            const catColor = categories[loc.category]?.color || '#666';
            const priorityClass = `priority-${loc.priority.toLowerCase()}`;

            // Check for session edits - use edited values if they exist
            const edits = sessionEdits[locIndex] || {};
            const dates = edits.dates !== undefined ? edits.dates : loc.dates;
            const bestTime = edits.bestTime !== undefined ? edits.bestTime : loc.bestTime;
            const admission = edits.admission !== undefined ? edits.admission : loc.admission;
            const permits = edits.permits !== undefined ? edits.permits : loc.permits;
            const features = edits.features !== undefined ? edits.features : loc.features;
            const notes = edits.notes !== undefined ? edits.notes : loc.notes;
            const recommendation = edits.recommendation !== undefined ? edits.recommendation : (loc.recommendation || '');
            let coords = edits.coords !== undefined ? edits.coords : loc.coords;
            const mapsUrl = edits.mapsUrl !== undefined ? edits.mapsUrl : loc.mapsUrl;
            // Extract full precision coords from mapsUrl for display
            const urlCoordsMatch = mapsUrl.match(/[?&]q=(-?\d+\.?\d*),(-?\d+\.?\d*)/);
            if (urlCoordsMatch) {
                coords = [parseFloat(urlCoordsMatch[1]), parseFloat(urlCoordsMatch[2])];
            }

            let badges = '';
            if (loc.nationalPark) badges += '<span class="popup-badge">üèûÔ∏è National Park</span>';
            if (loc.unesco) badges += '<span class="popup-badge">üèõÔ∏è UNESCO</span>';
            if (loc.birthplace) badges += '<span class="popup-badge">ü•á Birthplace: ' + loc.birthplace + '</span>';
            if (loc.livingCraft) badges += '<span class="popup-badge">üî® Living Craft</span>';

            return `
                <div class="location-popup ${priorityClass}" data-loc-index="${locIndex}">
                    <div class="popup-header" style="background: ${catColor}">
                        <h3>${loc.name}</h3>
                        <div class="popup-badges">
                            <span class="popup-badge">${loc.category}</span>
                            <span class="popup-badge">${loc.priority} Priority</span>
                            ${badges}
                        </div>
                    </div>
                    <div class="popup-body" id="popup-body-${locIndex}">
                        <div class="popup-meta">
                            <div class="popup-meta-item" data-field="dates">
                                <label>Dates</label>
                                <span>${dates}</span>
                                <input type="text" class="editable-field" value="${dates}" style="display:none;">
                            </div>
                            <div class="popup-meta-item" data-field="bestTime">
                                <label>Best Time</label>
                                <span>${bestTime}</span>
                                <input type="text" class="editable-field" value="${bestTime}" style="display:none;">
                            </div>
                            <div class="popup-meta-item" data-field="admission">
                                <label>Admission</label>
                                <span>${admission}</span>
                                <input type="text" class="editable-field" value="${admission}" style="display:none;">
                            </div>
                            <div class="popup-meta-item" data-field="permits">
                                <label>Permits</label>
                                <span>${permits}</span>
                                <input type="text" class="editable-field" value="${permits}" style="display:none;">
                            </div>
                        </div>
                        <div class="popup-features">${features}</div>
                        <textarea class="editable-field" data-field="features" style="display:none;">${features}</textarea>
                        <div class="popup-notes"><strong>Production Notes:</strong> <span class="popup-notes-text">${notes}</span></div>
                        <textarea class="editable-field" data-field="notes" style="display:none;">${notes}</textarea>
                        ${recommendation ? `<div class="popup-recommendation ${loc.recommendationType}"><strong>Recommendation:</strong> <span class="popup-recommendation-text">${recommendation}</span></div><textarea class="editable-field" data-field="recommendation" style="display:none;">${recommendation}</textarea>` : ''}
                        ${loc.readMoreUrl ? `<div class="popup-links"><a href="${loc.readMoreUrl}" target="_blank" class="popup-link">üì∞ Read More: ${loc.readMoreSource} ‚Üí</a></div>` : ''}
                        <div class="popup-meta edit-only-fields" style="display:none; margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 10px;">
                            <div class="popup-meta-item" data-field="coords">
                                <label>üìç Coordinates</label>
                                <input type="text" class="editable-field coords-input" value="[${coords[0]}, ${coords[1]}]" data-original="[${loc.coords[0]}, ${loc.coords[1]}]" oninput="updateMapsUrlFromCoords(this, ${locIndex})">
                            </div>
                            <div class="popup-meta-item" data-field="mapsUrl">
                                <label>üó∫Ô∏è Maps URL</label>
                                <input type="text" class="editable-field maps-url-input" value="${mapsUrl}" data-original="${loc.mapsUrl}" style="font-size: 10px;">
                            </div>
                        </div>
                        <div class="popup-buttons">
                            <a href="${mapsUrl}" target="_blank" class="popup-button maps-link" data-loc-index="${locIndex}">üó∫Ô∏è Google Maps</a>
                            <a href="https://www.google.com/search?q=${encodeURIComponent(loc.name + ' ' + loc.region + ' Japan')}&udm=2" target="_blank" class="popup-button secondary">üñºÔ∏è Images</a>
                        </div>
                        <div class="edit-actions">
                            <button class="popup-edit-btn" onclick="enterEditMode(${locIndex})">‚úèÔ∏è Edit</button>
                            <button class="popup-edit-btn" onclick="saveEdits(${locIndex})" style="display:none;" data-save="${locIndex}">üíæ Save</button>
                            <button class="popup-edit-btn cancel" onclick="cancelEdits(${locIndex})" style="display:none;" data-cancel="${locIndex}">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Create region popup content
        function createRegionPopupContent(region) {
            return `
                <div class="region-popup">
                    <div class="popup-header" style="background: #1a5f7a">
                        <h3>${region.name} Region</h3>
                        <div class="popup-badges">
                            <span class="popup-badge">${region.dateRange}</span>
                        </div>
                    </div>
                    <div class="popup-body">
                        <div class="region-stats">
                            <div class="region-stat">
                                <div class="region-stat-value">${region.locationCount}</div>
                                <div class="region-stat-label">Locations</div>
                            </div>
                            <div class="region-stat">
                                <div class="region-stat-value">${region.budget}</div>
                                <div class="region-stat-label">Est. Budget</div>
                            </div>
                        </div>
                        <div class="popup-features"><strong>Key Themes:</strong> ${region.themes}</div>
                        <div class="popup-notes" style="margin-top: 10px;"><strong>Logistics Hub:</strong> ${region.hub}</div>
                    </div>
                </div>
            `;
        }

        // Create transport popup content
        function createTransportPopupContent(segment) {
            let notesHtml = segment.notes ? `<div class="popup-notes" style="margin-top: 10px;">${segment.notes}</div>` : '';
            return `
                <div class="transport-popup">
                    <div class="popup-header">
                        <h3>Transportation</h3>
                        <div class="popup-badges">
                            <span class="popup-badge">${segment.date}</span>
                        </div>
                    </div>
                    <div class="popup-body">
                        <div class="transport-route">
                            <div class="transport-point">
                                <div class="city">${segment.from}</div>
                            </div>
                            <div class="transport-arrow">‚Üí</div>
                            <div class="transport-point">
                                <div class="city">${segment.to}</div>
                            </div>
                        </div>
                        <div class="popup-meta">
                            <div class="popup-meta-item">
                                <label>Mode</label>
                                <span>${segment.mode}</span>
                            </div>
                            <div class="popup-meta-item">
                                <label>Duration</label>
                                <span>${segment.duration}</span>
                            </div>
                            <div class="popup-meta-item">
                                <label>Cost</label>
                                <span>${segment.cost}</span>
                            </div>
                        </div>
                        ${notesHtml}
                    </div>
                </div>
            `;
        }

        // Add location markers and store references
        const categoryCounts = {};
        const locationMarkers = {}; // Store marker references by location name

        locations.forEach((loc, index) => {
            const cat = loc.category;
            if (!categoryCounts[cat]) categoryCounts[cat] = 0;
            categoryCounts[cat]++;

            const color = categories[cat]?.color || '#666';
            const marker = L.marker(loc.coords, {
                icon: createMarkerIcon(color, loc.priority)
            });
            marker.bindPopup(() => createPopupContent(loc, index), { maxWidth: 350 });

            // Store marker reference with index for unique identification
            locationMarkers[index] = { marker, location: loc };

            if (categoryLayers[cat]) {
                marker.addTo(categoryLayers[cat]);
            }
        });

        // Add region markers
        regions.forEach(region => {
            const marker = L.marker(region.coords, {
                icon: createRegionIcon()
            });
            marker.bindPopup(createRegionPopupContent(region), { maxWidth: 320 });
            marker.addTo(regionLayer);
        });

        // Add transport routes
        transportSegments.forEach(segment => {
            const polyline = L.polyline([segment.fromCoords, segment.toCoords], {
                color: '#6c757d',
                weight: 2,
                opacity: 0.6,
                dashArray: '5, 10'
            });
            polyline.bindPopup(createTransportPopupContent(segment), { maxWidth: 300 });
            polyline.addTo(transportLayer);
        });

        // Add layers to map
        regionLayer.addTo(map);
        transportLayer.addTo(map);

        // Build category legend
        const legendContainer = document.getElementById('category-legend');
        Object.keys(categories).forEach(cat => {
            if (cat === 'Regional Overview') return;
            const count = categoryCounts[cat] || 0;
            const item = document.createElement('div');
            item.className = 'legend-item';
            item.dataset.category = cat;
            item.innerHTML = `
                <div class="legend-color" style="background: ${categories[cat].color}"></div>
                <span class="legend-label">${cat}</span>
                <span class="legend-count">${count}</span>
            `;
            item.onclick = () => toggleCategory(cat);
            legendContainer.appendChild(item);
        });

        // Toggle functions
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function toggleCategory(cat) {
            const layer = categoryLayers[cat];
            const item = document.querySelector(`[data-category="${cat}"]`);
            if (map.hasLayer(layer)) {
                map.removeLayer(layer);
                item.classList.add('disabled');
            } else {
                map.addLayer(layer);
                item.classList.remove('disabled');
            }
        }

        function toggleLayer(type) {
            if (type === 'transport') {
                if (map.hasLayer(transportLayer)) {
                    map.removeLayer(transportLayer);
                } else {
                    map.addLayer(transportLayer);
                }
            } else if (type === 'regions') {
                if (map.hasLayer(regionLayer)) {
                    map.removeLayer(regionLayer);
                } else {
                    map.addLayer(regionLayer);
                }
            }
        }

        // Location list functions
        function toggleLocationsSection() {
            const header = document.querySelector('.sidebar-section .section-header');
            const content = document.getElementById('locations-section');
            header.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        }

        function toggleCategoryGroup(cat, event) {
            if (event) event.stopPropagation();
            const header = document.querySelector(`[data-cat-header="${cat}"]`);
            const content = document.querySelector(`[data-cat-list="${cat}"]`);
            if (header && content) {
                header.classList.toggle('collapsed');
                content.classList.toggle('collapsed');
            }
        }

        function expandAllCategories(event) {
            if (event) event.stopPropagation();
            document.querySelectorAll('.category-header').forEach(h => h.classList.remove('collapsed'));
            document.querySelectorAll('.category-locations').forEach(c => c.classList.remove('collapsed'));
        }

        function collapseAllCategories(event) {
            if (event) event.stopPropagation();
            document.querySelectorAll('.category-header').forEach(h => h.classList.add('collapsed'));
            document.querySelectorAll('.category-locations').forEach(c => c.classList.add('collapsed'));
        }

        function navigateToLocation(index) {
            const data = locationMarkers[index];
            if (!data) return;

            const { marker, location } = data;

            // Ensure the category layer is visible
            const cat = location.category;
            if (categoryLayers[cat] && !map.hasLayer(categoryLayers[cat])) {
                map.addLayer(categoryLayers[cat]);
                const legendItem = document.querySelector(`[data-category="${cat}"]`);
                if (legendItem) legendItem.classList.remove('disabled');
            }

            // Pan and zoom to location
            map.setView(location.coords, 14, { animate: true });

            // Open popup after pan completes
            setTimeout(() => {
                marker.openPopup();
            }, 300);

            // On mobile, collapse sidebar after selection
            if (window.innerWidth <= 600) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        // Build the location list grouped by category
        function buildLocationList() {
            const listContainer = document.getElementById('location-list');

            // Group locations by category
            const grouped = {};
            const categoryOrder = ['Landscape/Nature', 'Food/Culture', 'Architecture', 'Onsen/Hot Spring', 'Winter Activity', 'Transport Hub', 'Wildlife', 'Craft/Culture'];

            locations.forEach((loc, index) => {
                if (!grouped[loc.category]) {
                    grouped[loc.category] = [];
                }
                grouped[loc.category].push({ ...loc, index });
            });

            // Sort locations within each category alphabetically
            Object.keys(grouped).forEach(cat => {
                grouped[cat].sort((a, b) => a.name.localeCompare(b.name));
            });

            // Build HTML for each category
            categoryOrder.forEach(cat => {
                if (!grouped[cat] || grouped[cat].length === 0) return;

                const color = categories[cat]?.color || '#666';
                const group = document.createElement('div');
                group.className = 'category-group';

                // Category header
                const header = document.createElement('div');
                header.className = 'category-header collapsed';
                header.dataset.catHeader = cat;
                header.onclick = () => toggleCategoryGroup(cat);
                header.innerHTML = `
                    <div class="category-dot" style="background: ${color}"></div>
                    <span class="category-name">${cat}</span>
                    <span class="legend-count">${grouped[cat].length}</span>
                    <span class="category-toggle">‚ñº</span>
                `;

                // Location list for this category
                const locList = document.createElement('div');
                locList.className = 'category-locations collapsed';
                locList.dataset.catList = cat;

                grouped[cat].forEach(loc => {
                    const item = document.createElement('div');
                    item.className = 'location-item' + (loc.priority === 'High' ? ' high-priority' : '');
                    item.onclick = () => navigateToLocation(loc.index);
                    item.innerHTML = `
                        <div class="location-dot" style="background: ${color}"></div>
                        <span class="location-name" title="${loc.name}">${loc.name}</span>
                        ${loc.priority === 'High' ? '<span class="priority-star">‚òÖ</span>' : ''}
                    `;
                    locList.appendChild(item);
                });

                group.appendChild(header);
                group.appendChild(locList);
                listContainer.appendChild(group);
            });
        }

        // Initialize location list
        buildLocationList();

        // Fit map to show all markers on load
        const allCoords = locations.map(l => l.coords);
        if (allCoords.length > 0) {
            map.fitBounds(allCoords, { padding: [50, 50] });
        }

        // ===== DEV TOOLS: Edit Mode & GPS Capture =====

        // Toggle Edit Mode
        function toggleEditMode() {
            const isOn = document.getElementById('editModeToggle').checked;
            document.body.classList.toggle('edit-mode-on', isOn);
        }

        // Enter edit mode for a specific location popup
        function enterEditMode(locIndex) {
            const popupBody = document.getElementById(`popup-body-${locIndex}`);
            if (!popupBody) return;

            // Capture original values for export comparison
            captureOriginalValues(locIndex);

            popupBody.classList.add('editing');

            // Show input fields, hide display spans
            popupBody.querySelectorAll('.popup-meta-item').forEach(item => {
                const span = item.querySelector('span');
                const input = item.querySelector('input');
                if (span && input) {
                    span.style.display = 'none';
                    input.style.display = 'block';
                }
            });

            // Show textareas for features, notes, recommendation
            popupBody.querySelectorAll('textarea.editable-field').forEach(textarea => {
                textarea.style.display = 'block';
            });

            // Hide the display divs for features, notes, recommendation
            const features = popupBody.querySelector('.popup-features');
            const notes = popupBody.querySelector('.popup-notes');
            const recommendation = popupBody.querySelector('.popup-recommendation');
            if (features) features.style.display = 'none';
            if (notes) notes.style.display = 'none';
            if (recommendation) recommendation.style.display = 'none';

            // Show edit-only fields (coordinates, maps URL)
            const editOnlyFields = popupBody.querySelector('.edit-only-fields');
            if (editOnlyFields) editOnlyFields.style.display = 'block';

            // Toggle buttons
            popupBody.querySelector('.popup-edit-btn[onclick^="enterEditMode"]').style.display = 'none';
            popupBody.querySelector(`[data-save="${locIndex}"]`).style.display = 'inline-block';
            popupBody.querySelector(`[data-cancel="${locIndex}"]`).style.display = 'inline-block';
        }

        // Save edits and update display
        function saveEdits(locIndex) {
            const popupBody = document.getElementById(`popup-body-${locIndex}`);
            if (!popupBody) return;

            // Update meta item spans from inputs
            popupBody.querySelectorAll('.popup-meta-item').forEach(item => {
                const span = item.querySelector('span');
                const input = item.querySelector('input');
                if (span && input) {
                    span.textContent = input.value;
                    span.style.display = 'inline';
                    input.style.display = 'none';
                }
            });

            // Update features
            const featuresTextarea = popupBody.querySelector('textarea[data-field="features"]');
            const featuresDiv = popupBody.querySelector('.popup-features');
            if (featuresTextarea && featuresDiv) {
                featuresDiv.innerHTML = featuresTextarea.value;
                featuresDiv.style.display = 'block';
                featuresTextarea.style.display = 'none';
            }

            // Update notes
            const notesTextarea = popupBody.querySelector('textarea[data-field="notes"]');
            const notesSpan = popupBody.querySelector('.popup-notes-text');
            const notesDiv = popupBody.querySelector('.popup-notes');
            if (notesTextarea && notesSpan && notesDiv) {
                notesSpan.textContent = notesTextarea.value;
                notesDiv.style.display = 'block';
                notesTextarea.style.display = 'none';
            }

            // Update recommendation
            const recTextarea = popupBody.querySelector('textarea[data-field="recommendation"]');
            const recSpan = popupBody.querySelector('.popup-recommendation-text');
            const recDiv = popupBody.querySelector('.popup-recommendation');
            if (recTextarea && recSpan && recDiv) {
                recSpan.textContent = recTextarea.value;
                recDiv.style.display = 'block';
                recTextarea.style.display = 'none';
            }

            // Update coordinates and marker position
            const coordsInput = popupBody.querySelector('.coords-input');
            const mapsUrlInput = popupBody.querySelector('.maps-url-input');
            let markerMoved = false;
            let newMarkerPos = null;
            if (coordsInput) {
                const coordsMatch = coordsInput.value.match(/\[?\s*(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)\s*\]?/);
                if (coordsMatch) {
                    const newLat = parseFloat(coordsMatch[1]);
                    const newLng = parseFloat(coordsMatch[2]);

                    // Update marker position on map
                    const markerData = locationMarkers[locIndex];
                    if (markerData && markerData.marker) {
                        const oldPos = markerData.marker.getLatLng();
                        if (oldPos.lat !== newLat || oldPos.lng !== newLng) {
                            markerData.marker.setLatLng([newLat, newLng]);
                            markerData.location.coords = [newLat, newLng];
                            markerMoved = true;
                            newMarkerPos = [newLat, newLng];
                        }
                    }

                    // Update the stored original value for cancel
                    coordsInput.dataset.original = `[${newLat}, ${newLng}]`;
                }
            }

            // Update Google Maps link in popup
            if (mapsUrlInput) {
                const mapsLink = popupBody.querySelector('.maps-link');
                if (mapsLink) {
                    mapsLink.href = mapsUrlInput.value;
                }
                mapsUrlInput.dataset.original = mapsUrlInput.value;
            }

            // Hide edit-only fields
            const editOnlyFields = popupBody.querySelector('.edit-only-fields');
            if (editOnlyFields) editOnlyFields.style.display = 'none';

            // Exit edit mode
            popupBody.classList.remove('editing');
            popupBody.querySelector('.popup-edit-btn[onclick^="enterEditMode"]').style.display = 'inline-block';
            popupBody.querySelector(`[data-save="${locIndex}"]`).style.display = 'none';
            popupBody.querySelector(`[data-cancel="${locIndex}"]`).style.display = 'none';

            // Store edits in sessionEdits for persistence across popup close/reopen
            const loc = locations[locIndex];
            const getMetaValue = (field) => {
                const item = popupBody.querySelector(`[data-field="${field}"]`);
                const span = item?.querySelector('span');
                return span ? span.textContent : '';
            };

            // Parse coordinates - prefer coords input, but also extract from mapsUrl if changed
            let editedCoords = loc.coords;
            if (coordsInput) {
                const coordsMatch = coordsInput.value.match(/\[?\s*(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)\s*\]?/);
                if (coordsMatch) {
                    editedCoords = [parseFloat(coordsMatch[1]), parseFloat(coordsMatch[2])];
                }
            }
            // Also extract coords from mapsUrl if it was edited (captures edits made via URL field)
            if (mapsUrlInput && mapsUrlInput.value !== loc.mapsUrl) {
                const urlCoordsMatch = mapsUrlInput.value.match(/[?&]q=(-?\d+\.?\d*),(-?\d+\.?\d*)/);
                if (urlCoordsMatch) {
                    editedCoords = [parseFloat(urlCoordsMatch[1]), parseFloat(urlCoordsMatch[2])];
                }
            }

            sessionEdits[locIndex] = {
                dates: getMetaValue('dates'),
                bestTime: getMetaValue('bestTime'),
                admission: getMetaValue('admission'),
                permits: getMetaValue('permits'),
                features: featuresDiv ? featuresDiv.innerHTML : loc.features,
                notes: notesSpan ? notesSpan.textContent : loc.notes,
                recommendation: recSpan ? recSpan.textContent : (loc.recommendation || ''),
                coords: editedCoords,
                mapsUrl: mapsUrlInput ? mapsUrlInput.value : loc.mapsUrl
            };

            // Log the edited values to console for copy/paste
            console.log(`=== Location ${locIndex} Edits (stored in session) ===`);
            console.log(sessionEdits[locIndex]);

            // If marker moved, pan map to new position and reopen popup
            if (markerMoved && newMarkerPos) {
                const markerData = locationMarkers[locIndex];
                markerData.marker.closePopup();
                setTimeout(() => {
                    map.panTo(newMarkerPos, { animate: true });
                    setTimeout(() => {
                        markerData.marker.openPopup();
                    }, 300);
                }, 100);
            }
        }

        // Cancel edits and restore original values
        function cancelEdits(locIndex) {
            const popupBody = document.getElementById(`popup-body-${locIndex}`);
            if (!popupBody) return;

            // Restore meta item spans, reset inputs to match spans
            popupBody.querySelectorAll('.popup-meta-item').forEach(item => {
                const span = item.querySelector('span');
                const input = item.querySelector('input');
                if (span && input) {
                    input.value = span.textContent; // Reset input to original
                    span.style.display = 'inline';
                    input.style.display = 'none';
                }
            });

            // Hide textareas, show display divs
            popupBody.querySelectorAll('textarea.editable-field').forEach(textarea => {
                textarea.style.display = 'none';
            });

            const features = popupBody.querySelector('.popup-features');
            const notes = popupBody.querySelector('.popup-notes');
            const recommendation = popupBody.querySelector('.popup-recommendation');
            if (features) features.style.display = 'block';
            if (notes) notes.style.display = 'block';
            if (recommendation) recommendation.style.display = 'block';

            // Restore edit-only fields to original values and hide
            const coordsInput = popupBody.querySelector('.coords-input');
            const mapsUrlInput = popupBody.querySelector('.maps-url-input');
            if (coordsInput) coordsInput.value = coordsInput.dataset.original;
            if (mapsUrlInput) mapsUrlInput.value = mapsUrlInput.dataset.original;

            const editOnlyFields = popupBody.querySelector('.edit-only-fields');
            if (editOnlyFields) editOnlyFields.style.display = 'none';

            // Exit edit mode
            popupBody.classList.remove('editing');
            popupBody.querySelector('.popup-edit-btn[onclick^="enterEditMode"]').style.display = 'inline-block';
            popupBody.querySelector(`[data-save="${locIndex}"]`).style.display = 'none';
            popupBody.querySelector(`[data-cancel="${locIndex}"]`).style.display = 'none';
        }

        // Auto-update Maps URL when coordinates change
        function updateMapsUrlFromCoords(coordsInput, locIndex) {
            const coordsMatch = coordsInput.value.match(/\[?\s*(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)\s*\]?/);
            if (coordsMatch) {
                const lat = parseFloat(coordsMatch[1]);
                const lng = parseFloat(coordsMatch[2]);
                const popupBody = document.getElementById(`popup-body-${locIndex}`);
                const mapsUrlInput = popupBody?.querySelector('.maps-url-input');
                if (mapsUrlInput) {
                    mapsUrlInput.value = `https://maps.google.com/?q=${lat},${lng}`;
                }
            }
        }

        // ===== EXPORT CHANGES FEATURE =====
        // Store original values for each location when first edited
        const sessionOriginals = {};
        // Store all session edits persistently (survives popup close/reopen)
        const sessionEdits = {};

        // Capture original values when entering edit mode
        function captureOriginalValues(locIndex) {
            if (sessionOriginals[locIndex]) return; // Already captured

            const loc = locations[locIndex];
            sessionOriginals[locIndex] = {
                name: loc.name,
                dates: loc.dates,
                bestTime: loc.bestTime,
                admission: loc.admission,
                permits: loc.permits,
                features: loc.features,
                notes: loc.notes,
                recommendation: loc.recommendation || '',
                coords: `[${loc.coords[0]}, ${loc.coords[1]}]`,
                mapsUrl: loc.mapsUrl
            };
        }

        // Export changes function
        function exportChanges() {
            const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            let markdown = `**CLAUDE CODE INSTRUCTION: Update the Hokkaido interactive map (index.html) with the following changes. For each location listed, find the corresponding entry in the \`locations\` array and update the coords (lat/lng) and any other fields shown.**\n\n## MAP EDITS - ${today}\n\n`;
            let hasChanges = false;

            const fieldLabels = {
                dates: 'Dates',
                bestTime: 'Best Time',
                admission: 'Admission',
                permits: 'Permits',
                features: 'Features',
                notes: 'Production Notes',
                recommendation: 'Recommendation',
                coords: 'Coordinates',
                mapsUrl: 'Google Maps URL'
            };

            // Check each location that has session edits
            Object.keys(sessionEdits).sort((a, b) => parseInt(a) - parseInt(b)).forEach(locIndex => {
                const loc = locations[parseInt(locIndex)];
                const edits = sessionEdits[locIndex];
                const changes = [];

                // Compare edited values against original location data
                if (edits.dates !== loc.dates) {
                    changes.push({ field: 'dates', label: 'Dates', value: edits.dates });
                }
                if (edits.bestTime !== loc.bestTime) {
                    changes.push({ field: 'bestTime', label: 'Best Time', value: edits.bestTime });
                }
                if (edits.admission !== loc.admission) {
                    changes.push({ field: 'admission', label: 'Admission', value: edits.admission });
                }
                if (edits.permits !== loc.permits) {
                    changes.push({ field: 'permits', label: 'Permits', value: edits.permits });
                }
                if (edits.features !== loc.features) {
                    changes.push({ field: 'features', label: 'Features', value: edits.features });
                }
                if (edits.notes !== loc.notes) {
                    changes.push({ field: 'notes', label: 'Production Notes', value: edits.notes });
                }
                if (edits.recommendation !== (loc.recommendation || '')) {
                    changes.push({ field: 'recommendation', label: 'Recommendation', value: edits.recommendation });
                }
                // Compare coords as arrays - export as "lat, lng" format for code updates
                const origCoords = `${loc.coords[0]}, ${loc.coords[1]}`;
                const editCoords = `${edits.coords[0]}, ${edits.coords[1]}`;
                if (origCoords !== editCoords) {
                    changes.push({ field: 'coords', label: 'Coordinates', value: editCoords });
                }
                if (edits.mapsUrl !== loc.mapsUrl) {
                    changes.push({ field: 'mapsUrl', label: 'Google Maps URL', value: edits.mapsUrl });
                }

                if (changes.length > 0) {
                    hasChanges = true;
                    markdown += `### Location #${parseInt(locIndex) + 1}: ${loc.name}\n`;
                    changes.forEach(change => {
                        // For long text fields, use a different format
                        if (['features', 'notes', 'recommendation'].includes(change.field) && change.value.length > 80) {
                            markdown += `- **${change.label}:**\n  ${change.value}\n`;
                        } else {
                            markdown += `- **${change.label}:** ${change.value}\n`;
                        }
                    });
                    markdown += '\n';
                }
            });

            const exportContent = document.getElementById('exportContent');
            if (hasChanges) {
                exportContent.textContent = markdown.trim();
            } else {
                exportContent.innerHTML = '<span class="no-changes-msg">No changes detected. Edit some location cards first.</span>';
            }

            document.getElementById('exportModal').classList.add('show');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('show');
        }

        function copyExportToClipboard() {
            const content = document.getElementById('exportContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                const btn = document.querySelector('.export-copy-btn');
                const originalText = btn.textContent;
                btn.textContent = '‚úì Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }

        // Close modal on overlay click
        document.getElementById('exportModal').addEventListener('click', function(e) {
            if (e.target === this) closeExportModal();
        });

        // Right-click GPS capture
        map.on('contextmenu', function(e) {
            const lat = e.latlng.lat.toFixed(6);
            const lng = e.latlng.lng.toFixed(6);
            const coordsText = `[${lat}, ${lng}]`;

            // Copy to clipboard
            navigator.clipboard.writeText(coordsText).then(() => {
                // Show toast
                const toast = document.getElementById('coordsToast');
                toast.textContent = `üìç Copied: ${coordsText}`;
                toast.classList.add('show');

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2500);
            }).catch(err => {
                console.error('Failed to copy coords:', err);
            });
        });
    </script>
</body>
</html>
